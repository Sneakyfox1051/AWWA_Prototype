<!DOCTYPE html>
<html lang="en">
<head>
    <!--
    ===========================================
    AWWA FAMILY MANAGEMENT SYSTEM - SUPER USER DASHBOARD
    ===========================================
    
    PURPOSE: Enhanced dashboard with advanced features for super users and administrators
    TARGET USERS: Super users (L1 level) and administrators with elevated privileges
    FEATURES:
    - All features from main dashboard PLUS:
    - Advanced analytics and reporting capabilities
    - Enhanced data visualization with additional chart types
    - Super user specific navigation and controls
    - Advanced user management features
    - Enhanced Power BI integration
    - Extended D-ID chatbot capabilities
    
    DIFFERENCES FROM MAIN DASHBOARD:
    - Additional chart types and analytics
    - Enhanced navigation with super user specific sections
    - Advanced data processing capabilities
    - Extended user profile management
    - Enhanced security and access controls
    
    DATA SOURCE: Same as main dashboard (624 EME BN Excel file)
    - 274 total families across 7 workshop units
    - 183 total children with detailed records
    - 5 women registered for AWWA entrepreneurship program
    - Comprehensive health, education, and demographic data
    
    DEPENDENCIES:
    - dashboard.css: Main stylesheet for dashboard styling
    - Chart.js: Interactive charts and data visualization
    - Font Awesome: Icons and UI elements
    - Tailwind CSS: Responsive design framework
    - XLSX library: Excel file processing
    - D-ID Agent: AI chatbot integration
    
    NAVIGATION FLOW:
    login.html → dashboard_super user.html (this file)
    logout → login.html
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AWWA - Dashboard Home</title>
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Tailwind CSS for enhanced charts -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Inter font family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- D-ID Agent Chatbot - Badi Didi -->
    <script type="module"
          src="https://agent.d-id.com/v2/index.js"
          data-mode="fabio"
          data-client-key="Z29vZ2xlLW9hdXRoMnwxMDQ1ODAxOTI0NzE1ODExNjczNzI6RjhQTHZmLTVLU3A2Tng1V2JVYjFt"
          data-agent-id="v2_agt_G23N5m1h"
          data-name="did-agent"
          data-monitor="true"
          data-orientation="horizontal"
          data-position="left"
          data-allow-microphone="true"
          data-require-https="true">
    </script>
    
    <style>
        /* Enhanced Charts Styles */
        .enhanced-charts-section {
            margin-bottom: 40px;
        }

        .section-subtitle {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--brand-primary);
            display: inline-block;
            width: 100%;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }

        .enhanced-chart-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .enhanced-chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--brand-primary), #ff9500);
            border-radius: 16px 16px 0 0;
        }

        .enhanced-chart-card:hover {
            transform: translateY(-8px) !important;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.3) !important;
            border-color: rgba(229, 90, 43, 0.3) !important;
            border-width: 2px !important;
        }

        /* Removed large class - all charts now equal width */

        /* Children section specific grid layout */
        .children-charts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }

        .children-charts-grid .enhanced-chart-card:nth-child(4),
        .children-charts-grid .enhanced-chart-card:nth-child(5),
        .children-charts-grid .enhanced-chart-card:nth-child(6) {
            grid-column: span 1;
        }

        /* Families Grid Layout */
        .families-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }

        /* Mobile Navigation Toggle - TO BE FIXED BY JYOTI */
        /* Current implementation has issues with visibility and functionality */
        .nav-toggle {
            display: none;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            color: #374151;
            font-size: 16px;
            cursor: pointer;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 8px;
            width: 100%;
            text-align: left;
            transition: all 0.3s ease;
        }

        .nav-toggle:hover {
            background: #e9ecef;
            color: var(--brand-primary);
        }

        .nav-toggle i {
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        .nav-toggle.active i {
            transform: rotate(180deg);
        }

        .lp-nav {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .lp-nav.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
            padding: 0;
        }

        .lp-nav.expanded {
            max-height: 500px;
            opacity: 1;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .large-chart-container {
            position: relative;
            height: 500px;
            width: 100%;
        }

        .small-chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* About Deep Popup Styles */
        .about-deep-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .about-deep-popup.open {
            opacity: 1;
            visibility: visible;
        }

        .about-deep-popup.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .about-deep-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .about-deep-content {
            position: relative;
            background: white;
            border-radius: 20px;
            max-width: 90vw;
            max-height: 90vh;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .about-deep-popup.open .about-deep-content {
            transform: scale(1);
        }

        .about-deep-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: linear-gradient(135deg, #ff7a00, #ff9500);
            color: white;
        }

        .about-deep-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .about-deep-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .about-deep-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .about-deep-images {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            overflow: auto;
        }

        .about-deep-image {
            max-width: 45%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .about-deep-image:hover {
            transform: scale(1.05);
        }

        /* Responsive Design for About Deep Popup */
        @media (max-width: 768px) {
            .about-deep-images {
                flex-direction: column;
                gap: 15px;
                padding: 20px;
            }

            .about-deep-image {
                max-width: 100%;
                max-height: 40vh;
            }

            .about-deep-header {
                padding: 15px 20px;
            }

            .about-deep-header h2 {
                font-size: 20px;
            }
        }
        .modal-overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.6) !important;
                backdrop-filter: blur(5px);
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                z-index: 99999 !important;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .modal-overlay:not(.hidden) {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            .modal-overlay.hidden {
                opacity: 0 !important;
                visibility: hidden !important;
            }
            
            .modal-container {
                background: white !important;
                border-radius: 20px !important;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
                max-width: 900px !important;
                width: 90% !important;
                max-height: 90vh !important;
                overflow: hidden !important;
                transform: scale(0.9) translateY(20px) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                margin: 20px !important;
            }
            
            .modal-overlay:not(.hidden) .modal-container {
                transform: scale(1) translateY(0) !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
                color: white;
                padding: 25px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
                overflow: hidden;
            }
            
            .modal-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
                pointer-events: none;
            }
            
            .modal-title {
                display: flex;
                align-items: center;
                gap: 12px;
                position: relative;
                z-index: 1;
            }
            
            .modal-title i {
                font-size: 24px;
                background: rgba(255, 255, 255, 0.2);
                padding: 12px;
                border-radius: 12px;
                backdrop-filter: blur(10px);
            }
            
            .modal-title h3 {
                margin: 0;
                font-size: 24px;
                font-weight: 700;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            .modal-close-btn {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
                position: relative;
                z-index: 1;
            }
            
            .modal-close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.1);
            }
            
            .modal-body {
                padding: 0;
                max-height: calc(90vh - 100px);
                overflow-y: auto;
            }
            
            .add-family-form {
                padding: 30px;
            }

        /* Tablet Responsive Design */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .children-charts-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }
            
            .families-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .enhanced-chart-card.large {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            /* Main Layout */
            .dash-layout {
                flex-direction: column;
            }
            
            .left-panel {
                width: 100%;
                height: auto;
                position: relative;
                padding: 16px;
            }
            
            .main-area {
                width: 100%;
                padding: 16px;
            }
            
            /* Header */
            .app-header {
                padding: 12px 16px;
            }
            
            .app-title {
                font-size: 16px;
                color: #1F2937;
            }
            
            .title-orange {
                color: #ff8c00 !important;
            }
            
            .app-title .title-orange {
                color: #ff8c00 !important;
            }
            
            .logout-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
    /* Left Panel */
    .lp-header {
        flex-direction: column;
        text-align: center;
        padding: 16px;
    }
    
    .lp-name {
        font-size: 16px;
        margin: 8px 0 4px 0;
    }
    
    .lp-role {
        font-size: 12px;
    }
    
    /* Navigation Toggle */
    .nav-toggle {
        display: block !important;
        width: 100%;
        text-align: left;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin: 8px 0;
        padding: 12px 16px;
        font-size: 16px;
        color: #374151;
        cursor: pointer;
    }
    
    .lp-nav {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 0.3s ease;
        margin: 0;
        padding: 0;
    }
    
    .lp-nav.expanded {
        max-height: 500px;
        opacity: 1;
        margin: 8px 0;
        padding: 8px 0;
    }
    
    .lp-nav ul {
        flex-direction: column;
        gap: 4px;
        padding: 8px 0;
    }
    
    .lp-nav li {
        width: 100%;
        text-align: left;
        padding: 12px 16px;
        border-radius: 8px;
        background: #f8f9fa;
        margin: 2px 0;
    }
    
    .lp-nav li:hover {
        background: #e9ecef;
    }
    
    .lp-nav li i {
        font-size: 16px;
        margin-right: 12px;
        width: 20px;
    }
    
    .lp-nav li span {
        font-size: 14px;
    }
            
            /* Welcome Section */
            .welcome-section-card {
                padding: 16px;
            }
            
            .welcome-title {
                font-size: 24px;
                margin-bottom: 16px;
            }
            
            .user-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .panel-card {
                padding: 16px;
            }
            
            .panel-header h3 {
                font-size: 16px;
            }
            
            /* Wife Profile Image Styling */
            .panel-header-image {
                text-align: center;
                margin-bottom: 20px;
                padding: 10px;
            }
            
            .wife-profile-image {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                object-fit: cover;
                border: 4px solid #ff7a00;
                box-shadow: 0 4px 15px rgba(255, 122, 0, 0.3);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .wife-profile-image:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 20px rgba(255, 122, 0, 0.4);
            }
            
            .profile-side-card {
                padding: 16px;
                text-align: center;
            }
            
            /* Stats Cards */
            .stats-card-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin: 16px 0;
            }
            
            .stat-mini-card {
                padding: 12px;
            }
            
            .mini-value {
                font-size: 20px;
            }
            
            .mini-content small {
                font-size: 11px;
            }
            
            /* Charts */
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .children-charts-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            /* All charts now equal width */
            
            .chart-container {
                height: 300px;
            }
            
            .large-chart-container {
                height: 350px;
            }
            
            .enhanced-chart-card {
                padding: 16px;
            }
            
            .section-subtitle {
                font-size: 18px;
                margin-bottom: 20px;
            }
            
            /* Families Section */
            .families-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .workshop-buttons {
                justify-content: center;
            }
            
            .workshop-btn {
                font-size: 12px;
                padding: 6px 12px;
            }

            .families-actions .check-btn {
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .add-family-form {
                    padding: 20px;
                }
                
                .form-row {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }
                
                .form-actions {
                    flex-direction: column;
                    gap: 15px;
                }
                
                .btn-primary,
                .btn-secondary {
                    width: 100%;
                    justify-content: center;
                }
            }

        .families-actions .check-btn i {
            font-size: 14px;
        }

        .workshop-filter {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #374151;
            min-width: 150px;
        }

        .workshop-filter:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
            
            /* Modal Popup Styling */
            .modal-overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.6) !important;
                backdrop-filter: blur(5px);
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                z-index: 99999 !important;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .modal-overlay:not(.hidden) {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            .modal-overlay.hidden {
                opacity: 0 !important;
                visibility: hidden !important;
            }
            
            .modal-container {
                background: white !important;
                border-radius: 20px !important;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
                max-width: 900px !important;
                width: 90% !important;
                max-height: 90vh !important;
                overflow: hidden !important;
                transform: scale(0.9) translateY(20px) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                margin: 20px !important;
            }
            
            .modal-overlay:not(.hidden) .modal-container {
                transform: scale(1) translateY(0) !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
                color: white;
                padding: 25px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
                overflow: hidden;
            }
            
            .modal-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
                pointer-events: none;
            }
            
            .modal-title {
                display: flex;
                align-items: center;
                gap: 12px;
                position: relative;
                z-index: 1;
            }
            
            .modal-title i {
                font-size: 24px;
                background: rgba(255, 255, 255, 0.2);
                padding: 12px;
                border-radius: 12px;
                backdrop-filter: blur(10px);
            }
            
            .modal-title h3 {
                margin: 0;
                font-size: 24px;
                font-weight: 700;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            .modal-close-btn {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
                position: relative;
                z-index: 1;
            }
            
            .modal-close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.1);
            }
            
            .modal-body {
                padding: 0;
                max-height: calc(90vh - 100px);
                overflow-y: auto;
            }
            
            .add-family-form {
                padding: 30px;
            }
            
            .form-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .form-group {
                display: flex;
                flex-direction: column;
            }
            
            .form-group.full-width {
                grid-column: 1 / -1;
            }
            
            .form-group label {
                font-weight: 600;
                color: #374151;
                margin-bottom: 6px;
                font-size: 14px;
            }
            
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 14px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                font-size: 14px;
                transition: all 0.3s ease;
                background: #fafafa;
                font-family: inherit;
            }
            
            .form-group input:focus,
            .form-group select:focus,
            .form-group textarea:focus {
                outline: none;
                border-color: #ff8c00;
                box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.1);
                background: white;
                transform: translateY(-1px);
            }
            
            .form-group input[required] {
                border-color: #ff8c00;
                background: linear-gradient(135deg, #fff5e6 0%, #ffffff 100%);
            }
            
            .form-group input[required]:focus {
                background: white;
                box-shadow: 0 0 0 4px rgba(255, 140, 0, 0.15);
            }
            
            .form-section-header {
                margin: 40px 0 25px 0;
                padding: 20px 0 15px 0;
                border-bottom: 3px solid #ff8c00;
                background: linear-gradient(135deg, #fff5e6 0%, #ffffff 100%);
                border-radius: 12px;
                padding: 20px;
                position: relative;
                overflow: hidden;
            }
            
            .form-section-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255, 140, 0, 0.05) 0%, transparent 50%, rgba(255, 140, 0, 0.05) 100%);
                pointer-events: none;
            }
            
            .form-section-header h4 {
                color: #ff8c00;
                font-size: 20px;
                font-weight: 700;
                margin: 0;
                position: relative;
                z-index: 1;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .form-section-header h4::before {
                content: '●';
                color: #ff8c00;
                font-size: 16px;
            }
            
            .form-actions {
                display: flex;
                gap: 20px;
                justify-content: flex-end;
                margin-top: 40px;
                padding: 25px 0 10px 0;
                border-top: 2px solid #ff8c00;
                background: linear-gradient(135deg, #fff5e6 0%, #ffffff 100%);
                margin: 40px -30px 0 -30px;
                padding: 25px 30px;
            }
            
            .btn-primary,
            .btn-secondary {
                padding: 14px 28px;
                border-radius: 12px;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 16px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                position: relative;
                overflow: hidden;
            }
            
            .btn-primary {
                background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
                color: white;
                border: none;
                box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
            }
            
            .btn-primary:hover {
                background: linear-gradient(135deg, #ff7f00 0%, #e67300 100%);
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(255, 140, 0, 0.4);
            }
            
            .btn-primary:active {
                transform: translateY(0);
                box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
            }
            
            .btn-secondary {
                background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
                color: #6b7280;
                border: 2px solid #d1d5db;
            }
            
            .btn-secondary:hover {
                background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
                border-color: #9ca3af;
                color: #374151;
                transform: translateY(-1px);
            }

            
            
            /* Desktop Modal Styling */
            @media (min-width: 769px) {

                .modal-overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.6) !important;
                backdrop-filter: blur(5px);
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                z-index: 99999 !important;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .modal-overlay:not(.hidden) {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            .modal-overlay.hidden {
                opacity: 0 !important;
                visibility: hidden !important;
            }
            
            .modal-container {
                background: white !important;
                border-radius: 20px !important;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
                max-width: 900px !important;
                width: 90% !important;
                max-height: 90vh !important;
                overflow: hidden !important;
                transform: scale(0.9) translateY(20px) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                margin: 20px !important;
            }
            
            .modal-overlay:not(.hidden) .modal-container {
                transform: scale(1) translateY(0) !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
                color: white;
                padding: 25px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
                overflow: hidden;
            }
            
            .modal-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
                pointer-events: none;
            }
            
            .modal-title {
                display: flex;
                align-items: center;
                gap: 12px;
                position: relative;
                z-index: 1;
            }
            
            .modal-title i {
                font-size: 24px;
                background: rgba(255, 255, 255, 0.2);
                padding: 12px;
                border-radius: 12px;
                backdrop-filter: blur(10px);
            }
            
            .modal-title h3 {
                margin: 0;
                font-size: 24px;
                font-weight: 700;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            .modal-close-btn {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
                position: relative;
                z-index: 1;
            }
            
            .modal-close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.1);
            }
            
            .modal-body {
                padding: 0;
                max-height: calc(90vh - 100px);
                overflow-y: auto;
            }
            
            .add-family-form {
                padding: 30px;
            }
                .modal-overlay {
                    z-index: 10000;
                }
                
                .modal-container {
                    max-width: 1000px;
                    width: 85%;
                    margin: 40px auto;
                }
                
                .modal-body {
                    max-height: calc(90vh - 120px);
                }
                
                .form-row {
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 25px;
                }
            }
            
            /* Mobile Responsiveness for Modal */
            @media (max-width: 768px) {
                .modal-container {
                    width: 95%;
                    max-height: 95vh;
                    margin: 20px;
                }
                
                .modal-header {
                    padding: 20px;
                }
                
                .modal-title h3 {
                    font-size: 20px;
                }
                
                .add-family-form {
                    padding: 20px;
                }
                
                .form-row {
                    grid-template-columns: 1fr;
                    gap: 15px;
                }
                
                .form-actions {
                    flex-direction: column;
                    gap: 15px;
                }
                
                .btn-primary,
                .btn-secondary {
                    width: 100%;
                    justify-content: center;
                }
            }

        .families-actions .check-btn i {
            font-size: 14px;
        }

        .workshop-filter {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #374151;
            min-width: 150px;
        }

        .workshop-filter:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Header Layout - TO BE FIXED BY JYOTI */
        /* Current implementation not working - needs proper CSS for header positioning */
        /*
        .app-header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .app-brand {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .app-title-wrap {
            margin-left: 12px;
        }

        .app-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }
        
        .title-orange {
            color: #ff8c00 !important;
        }
        
        .app-title .title-orange {
            color: #ff8c00 !important;
        }

        .logout-btn {
            margin-left: auto;
        }
        */

            .no-data-message {
                text-align: center;
                padding: 40px 20px;
                color: #6b7280;
            }

            .no-data-message i {
                font-size: 48px;
                margin-bottom: 16px;
                color: #d1d5db;
            }

            .no-data-message p {
                font-size: 16px;
                margin: 0;
            }
            
            .fam-search {
                width: 100%;
            }
            
            .families-grid {
                gap: 12px;
            }
            
            .family-card {
                padding: 12px;
            }
            
            /* Newsletter Section */
            .newsletter-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .newsletter-form {
                padding: 16px;
            }
            
            /* Rankings Section */
            .ranking-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .rank-card {
                padding: 12px;
        }
        

        @media (max-width: 480px) {
            /* Extra Small Mobile */
            .app-title {
                font-size: 14px;
                color: #1F2937;
            }
            
            .title-orange {
                color: #ff8c00 !important;
            }
            
            .app-title .title-orange {
                color: #ff8c00 !important;
            }
            
            .welcome-title {
                font-size: 20px;
            }
            
            .stats-card-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .stat-mini-card {
                padding: 8px;
            }
            
            .mini-value {
                font-size: 18px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .large-chart-container {
                height: 300px;
            }
            
            .enhanced-chart-card {
                padding: 12px;
            }
            
            .section-subtitle {
                font-size: 16px;
            }
            
            .lp-nav li {
                min-width: 100px;
                padding: 6px 2px;
            }
            
            .lp-nav li span {
                font-size: 10px;
            }
            .profile-side-card{
                display:none;
            }
        }

        /* About Section Styling */
        .about-section {
            padding: 24px;
        }
        
        .about-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }
        
        .about-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        
        .about-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .about-header h3 {
            color: #1f2937;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .about-header h3 i {
            color: #ff8c00;
            margin-right: 12px;
        }
        
        .about-subtitle {
            color: #6b7280;
            font-size: 18px;
            font-weight: 500;
        }
        
        .about-description {
            margin-bottom: 32px;
        }
        
        .about-description p {
            color: #374151;
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
        }
        
        .about-features {
            margin-bottom: 32px;
        }
        
        .about-features h4 {
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .about-features h4 i {
            color: #ff8c00;
            margin-right: 8px;
        }
        
        .about-features ul {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }
        
        .about-features li {
            color: #374151;
            font-size: 15px;
            padding: 12px 16px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #ff8c00;
        }
        
        .about-features li i {
            color: #ff8c00;
            margin-right: 8px;
            width: 16px;
        }
        
        .about-stats {
            margin-bottom: 32px;
        }
        
        .about-stats h4 {
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .about-stats h4 i {
            color: #ff8c00;
            margin-right: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }
        
        .stat-number {
            display: block;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
        }
        
        .about-contact {
            text-align: center;
        }
        
        .about-contact h4 {
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .about-contact h4 i {
            color: #ff8c00;
            margin-right: 8px;
        }
        
        .contact-details p {
            color: #374151;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .contact-details strong {
            color: #1f2937;
        }
        
        /* Brochure Section Styling */
        .about-brochure {
            margin-top: 32px;
            text-align: center;
        }
        
        .about-brochure h4 {
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .about-brochure h4 i {
            color: #ff8c00;
            margin-right: 8px;
        }
        
        .brochure-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .brochure-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        
        .brochure-images {
            display: flex;
            width: 400px;
            height: 280px;
        }
        
        .brochure-image {
            width: 50%;
            height: 100%;
            object-fit: cover;
            border: 2px solid #fff;
        }
        
        .brochure-left {
            border-right: 1px solid #e5e7eb;
        }
        
        .brochure-right {
            border-left: 1px solid #e5e7eb;
        }
        
        .brochure-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .brochure-container:hover .brochure-overlay {
            opacity: 1;
        }
        
        .brochure-overlay i {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .brochure-overlay span {
            font-size: 16px;
            font-weight: 500;
        }
        
        /* Brochure Modal Styling */
        .brochure-modal {
            max-width: 90vw;
            max-height: 90vh;
            width: auto;
        }
        
        .brochure-modal-content {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        
        .brochure-modal-image {
            max-width: 45%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        @media (max-width: 768px) {
            .brochure-images {
                width: 300px;
                height: 210px;
            }
            
            .brochure-modal-content {
                flex-direction: column;
                align-items: center;
            }
            
            .brochure-modal-image {
                max-width: 90%;
                max-height: 40vh;
            }
        }

        /* Family Detail Modal Styling */
        .family-detail-modal {
            max-width: 1000px !important;
            width: 95% !important;
        }
        
        .family-detail-body {
            padding: 0 !important;
            max-height: 80vh !important;
            overflow-y: auto !important;
        }
        
        .family-detail-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .family-detail-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .family-detail-section h4 {
            color: #1e293b;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #ff8c00;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .family-detail-section h4 i {
            color: #ff8c00;
            font-size: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            color: #64748b;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }
        
        .detail-value {
            color: #1e293b;
            font-weight: 500;
            font-size: 15px;
            text-align: right;
            flex: 1;
            margin-left: 20px;
        }
        
        .detail-value.highlight {
            color: #ff8c00;
            font-weight: 700;
        }
        
        /* Children Information Styles */
        .children-info {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .child-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .child-item:hover {
            background: #f1f5f9;
            border-color: #ff8c00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.1);
        }
        
        .child-name {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .child-age {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }
        
        .no-children {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px dashed #e2e8f0;
        }
        
        
        .families-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Workshop Data Section Styles */
        .workshop-section {
            padding: 24px;
        }
        
        
        .workshop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .workshop-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .workshop-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border-color: #ff8c00;
        }
        
        .workshop-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .workshop-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .workshop-info h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 4px 0;
        }
        
        .workshop-info p {
            font-size: 14px;
            color: #64748b;
            margin: 0;
        }
        
        .workshop-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }
        
        .workshop-count {
            font-size: 24px;
            font-weight: 800;
            color: #ff8c00;
        }
        
        .workshop-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        /* FW Coy Analytics Styles */
        .fw-coy-analytics {
            margin-bottom: 2rem;
        }

        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.4);
        }

        .summary-icon {
            font-size: 2rem;
            opacity: 0.9;
        }

        .summary-content {
            flex: 1;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* FW Coy Controls */
        .fw-coy-controls {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center;
        }

        .filter-group, .sort-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label, .sort-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: #ff8c00;
            color: #ff8c00;
        }

        .filter-btn.active {
            background: #ff8c00;
            border-color: #ff8c00;
            color: white;
        }

        .sort-select {
            padding: 0.5rem 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            min-width: 200px;
        }

        .sort-select:focus {
            outline: none;
            border-color: #ff8c00;
        }


        /* Enhanced Workshop Cards */
        .workshop-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #ff8c00;
            position: relative;
            overflow: hidden;
        }

        .workshop-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff8c00, #ff9500);
        }

        .workshop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .workshop-card.fwc {
            border-left-color: #ff8c00;
        }

        .workshop-card.aw {
            border-left-color: #ff9500;
        }

        .workshop-card.bhq {
            border-left-color: #e67e00;
        }

        .workshop-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .workshop-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .workshop-card.fwc .workshop-icon {
            background: linear-gradient(135deg, #ff8c00, #ff9500);
        }

        .workshop-card.aw .workshop-icon {
            background: linear-gradient(135deg, #ff9500, #ffa500);
        }

        .workshop-card.bhq .workshop-icon {
            background: linear-gradient(135deg, #e67e00, #ff8c00);
        }

        .workshop-card:not(.fwc):not(.aw):not(.bhq) .workshop-icon {
            background: linear-gradient(135deg, #ff8c00, #ff9500);
        }

        .workshop-info h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1.2rem;
            color: #333;
        }

        .workshop-info p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .workshop-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workshop-count {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        /* Unit Details Modal */
        .unit-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .unit-detail-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .unit-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .unit-detail-title {
            font-size: 1.5rem;
            color: #333;
            margin: 0;
        }

        .unit-detail-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .unit-detail-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .unit-detail-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .unit-detail-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .unit-detail-card h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
            font-size: 1rem;
        }

        .unit-detail-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff8c00;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            /* FW Coy Analytics Summary */
            .analytics-summary {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
                margin-bottom: 1.5rem;
            }

            .summary-card {
                padding: 1rem;
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .summary-icon {
                font-size: 1.5rem;
            }

            .summary-value {
                font-size: 1.5rem;
            }

            .summary-label {
                font-size: 0.8rem;
            }

            /* FW Coy Controls */
            .fw-coy-controls {
                padding: 1rem;
                margin-bottom: 1.5rem;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .filter-group, .sort-group {
                width: 100%;
            }

            .filter-buttons {
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .filter-btn {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
                min-width: 80px;
            }

            .sort-select {
                width: 100%;
                min-width: unset;
            }


            /* Workshop Grid */
            .workshop-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .workshop-card {
                padding: 1rem;
                margin-bottom: 0.5rem;
            }

            .workshop-header {
                gap: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .workshop-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .workshop-info h3 {
                font-size: 1.1rem;
            }

            .workshop-info p {
                font-size: 0.8rem;
            }

            .workshop-count {
                font-size: 1.5rem;
            }

            .workshop-label {
                font-size: 0.8rem;
            }

            /* Unit Detail Modal */
            .unit-detail-content {
                width: 95%;
                padding: 1rem;
                max-height: 90vh;
            }

            .unit-detail-header {
                margin-bottom: 1rem;
                padding-bottom: 0.75rem;
            }

            .unit-detail-title {
                font-size: 1.2rem;
            }

            .unit-detail-body {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .unit-detail-card {
                padding: 0.75rem;
            }

            .unit-detail-card h4 {
                font-size: 0.9rem;
            }

            .unit-detail-card .value {
                font-size: 1.2rem;
            }
        }

        /* Extra Small Mobile Devices */
        @media (max-width: 480px) {
            .analytics-summary {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .summary-card {
                padding: 0.75rem;
            }

            .summary-value {
                font-size: 1.25rem;
            }

            .filter-buttons {
                gap: 0.25rem;
            }

            .filter-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
                min-width: 70px;
            }

            .workshop-card {
                padding: 0.75rem;
            }

            .workshop-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .workshop-info h3 {
                font-size: 1rem;
            }

            .workshop-count {
                font-size: 1.25rem;
            }

            .unit-detail-content {
                width: 98%;
                padding: 0.75rem;
            }
        }

        /* Touch Interactions */
        @media (hover: none) and (pointer: coarse) {
            .workshop-card {
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }

            .workshop-card:active {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }

            .filter-btn:active {
                transform: scale(0.95);
            }


            .summary-card:active {
                transform: translateY(-2px);
            }

            /* Improve touch targets */
            .filter-btn {
                min-height: 44px;
                min-width: 44px;
            }

            .workshop-card {
                min-height: 80px;
            }

            .unit-detail-close {
                min-height: 44px;
                min-width: 44px;
            }
        }

        /* Mobile Landscape Orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            .analytics-summary {
                grid-template-columns: repeat(4, 1fr);
            }

            .summary-card {
                padding: 0.75rem;
                flex-direction: row;
                text-align: left;
            }

            .summary-icon {
                font-size: 1.25rem;
            }

            .summary-value {
                font-size: 1.25rem;
            }

            .workshop-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Workshop Filter Buttons */
        .workshop-filter-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .workshop-filter-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }
        
        .workshop-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .workshop-btn {
            background: #f1f5f9;
            color: #64748b;
            border: 2px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .workshop-btn:hover {
            background: #ff8c00;
            color: white;
            border-color: #ff8c00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
        }
        
        .workshop-btn.active {
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            color: white;
            border-color: #ff8c00;
            box-shadow: 0 2px 8px rgba(255, 140, 0, 0.3);
        }
        
        .workshop-btn.active:hover {
            background: linear-gradient(135deg, #e67e00, #ff8c00);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 140, 0, 0.4);
        }
        
        /* Newsletter Analytics Styles */
        .newsletter-analytics {
            margin-bottom: 32px;
            padding: 24px;
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }
        
        .newsletter-analytics h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .analytics-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        
        .analytics-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .analytics-content {
            flex: 1;
        }
        
        .analytics-value {
            font-size: 28px;
            font-weight: 800;
            color: #1e293b;
            line-height: 1;
            margin-bottom: 4px;
        }
        
        .analytics-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .analytics-change {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .analytics-change.positive {
            background: #dcfce7;
            color: #166534;
        }
        
        .analytics-change.negative {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .analytics-change.neutral {
            background: #f1f5f9;
            color: #64748b;
        }
        
        /* Newsletter Benefits Styles */
        .newsletter-benefits {
            margin: 32px 0;
            padding: 24px;
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }
        
        .newsletter-benefits h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .benefit-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        
        .benefit-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border-color: #ff8c00;
        }
        
        .benefit-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff8c00, #ff9500);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .benefit-content h4 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .benefit-content p {
            font-size: 14px;
            color: #64748b;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Newsletter Title Section Styles */
        .newsletter-title-section {
            text-align: center;
            margin: 32px 0;
            padding: 32px 24px;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 2px solid #ff8c00;
        }
        
        .newsletter-bilingual-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 16px;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
            color: #ff8c00;
            letter-spacing: 1px;
        }
        
        .newsletter-description {
            font-size: 18px;
            font-weight: 500;
            margin: 0 0 24px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            line-height: 1.4;
            color: #e2e8f0;
            font-style: italic;
            letter-spacing: 0.5px;
        }
        
        
        @media (max-width: 768px) {
            .newsletter-bilingual-title {
                font-size: 22px;
            }
            
            .newsletter-description {
                font-size: 16px;
            }
            
        }
        
        @media (max-width: 480px) {
        }
        
        /* Newsletter Charts Styles */
        .newsletter-charts-section {
            margin-top: 32px;
            padding: 24px;
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }
        
        .newsletter-charts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-top: 20px;
        }
        
        @media (max-width: 1200px) {
            .newsletter-charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .newsletter-charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .family-photo {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .family-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ff8c00 0%, #ff7f00 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .contact-info {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 8px;
            color: #64748b;
            font-size: 14px;
        }
        
        .contact-item i {
            color: #ff8c00;
        }
        
        /* Family Card Clickable Styling */
        .family-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .family-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .family-card:active {
            transform: translateY(-2px);
        }
        
        /* Mobile Responsive for Family Detail Modal */
        @media (max-width: 768px) {
            .family-detail-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .family-detail-section {
                padding: 20px;
            }
            
            .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .detail-value {
                text-align: left;
                margin-left: 0;
            }
            
            .family-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .contact-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header class="app-header ">
        <div class="app-header-inner ">
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="app-brand">
                <img src="public/Untitled design (27).png" alt="AWWA Logo" class="app-logo" />
                <div class="app-title-wrap">
                    <h1 class="app-title">Ranbankura Eagles : FWO Centralised Information Hub</h1>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </header>
    
    <!-- Mobile Navigation Popup -->
    <div id="mobileNavPopup" class="mobile-nav-popup hidden">
        <div class="mobile-nav-overlay" onclick="closeMobileMenu()"></div>
        <div class="mobile-nav-content">
            <div class="mobile-nav-header">
                <h3>Navigation Menu</h3>
                <button class="mobile-nav-close" onclick="closeMobileMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="mobile-nav-menu">
                <ul>
                    <li class="mobile-nav-item active" data-target="section-dashboard" onclick="navigateToSection('section-dashboard')">
                        <i class="fas fa-home"></i>
                        <span>Master Dashboard</span>
                    </li>
                    <li class="mobile-nav-item" data-target="section-families" onclick="navigateToSection('section-families')">
                        <i class="fas fa-notes-medical"></i>
                        <span>All Families</span>
                    </li>
                    <li class="mobile-nav-item" data-target="section-companies" onclick="navigateToSection('section-companies')">
                        <i class="fas fa-building"></i>
                        <span>624 Sub Units</span>
                    </li>
                    <li class="mobile-nav-item" data-target="section-Newsletter" onclick="navigateToSection('section-Newsletter')">
                        <i class="fas fa-calendar"></i>
                        <span>Newsletter</span>
                    </li>
                    <li class="mobile-nav-item" data-target="section-Rankings" onclick="navigateToSection('section-Rankings')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Admin Users</span>
                    </li>
                    <li class="mobile-nav-item" onclick="openAboutDeepPopup()">
                        <i class="fas fa-info-circle"></i>
                        <span>About "Project Deep"</span>
                    </li>
        <!-- <li class="mobile-nav-item" data-target="section-about" onclick="navigateToSection('section-about')">
            <i class="fas fa-info-circle"></i>
            <span>About</span>
        </li> -->
                </ul>
        </div>
    </div>
    
    <div class="dash-layout">
        <!-- Left Side Panel -->
        <aside class="left-panel">

            <div class="lp-header">
                <button class="sidebar-toggle-btn" id="sidebarToggleBtn" onclick="toggleSidebar()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <img src="public/profile.png" alt="Profile" class="lp-avatar-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                <div class="lp-name">Col Tarunpreet Singh</div>
                <div class="lp-role">Commanding Officer</div>
            </div>
            
            <!-- Navigation Toggle Button - TO BE FIXED BY JYOTI -->
            <!-- Current implementation has issues with visibility and functionality -->
            
            <nav class="lp-nav" id="lpNav">
                <ul>
                    <li class="active" data-target="section-dashboard"><i class="fas fa-home"></i><span>Master Dashboard</span></li>
                    <li data-target="section-families"><i class="fas fa-notes-medical"></i><span>All Families</span></li>
                    <li data-target="section-companies"><i class="fas fa-building"></i><span>624 Sub Units</span></li>
                    <li data-target="section-Newsletter"><i class="fas fa-calendar"></i><span>Newsletter</span></li>
                    <li data-target="section-Rankings"><i class="fas fa-chart-bar"></i><span>Admin Users</span></li>
                    <li onclick="openAboutDeepPopup()"><i class="fas fa-info-circle"></i><span>About "Project Deep"</span></li>
                    <!-- <li data-target="section-about"><i class="fas fa-info-circle"></i><span>About</span></li> -->
                </ul>
            </nav>
            
        </aside>

        <!-- Main Area -->
        <div class="main-area">
    <div class="home-container app-section" id="section-dashboard">
        <!-- Welcome Header Row -->
        <section class="welcome-section-card">
            <h1 class="welcome-title" id="welcomeTitle">Welcome!</h1>

            <div class="user-grid">
                <!-- User Information -->
                <div class="panel-card">
                    <div class="panel-header">
                        <i class="fas fa-user-circle"></i>
                        <h3>User Information</h3>
                    </div>
                    <div class="panel-body" id="userInfoBody">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>

                <!-- Additional Details -->
                <div class="panel-card">
                    <div class="panel-header">
                       
                        <h3 id="additionalDetailsTitle">Additional Details</h3>
                        <div class="panel-header-image" id="additionalDetailsImage" style="display: none;">
                            <img src="" alt="Wife Image" id="wifeImage" />
                    </div>

                    </div>
                    <div class="panel-body" id="additionalDetailsBody">
                        <!-- Dynamic content will be loaded here -->
                      
                    </div>
                </div>

                <!-- Profile Card -->
                <div class="profile-side-card">
                    <img src="public/profile.png" alt="Profile" class="avatar-box-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                    <div class="avatar-box" style="display:none;" id="profileInitials">SB</div>
                    <div class="profile-meta">
                        <h4 id="profileName">Loading...</h4>
                        <p id="profileDesignation">Loading...</p>
                    </div>
                </div>
            </div>
        </section>

                <!-- Stats Cards -->
                <div class="stats-card-grid">
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-users"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="totalFamiliesVal">274</div>
                            <small>Total Families</small>
                </div>
            </div>
            
                 <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-child"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="totalChildrenVal">509</div>
                            <small>Total Children</small>
                            <div class="gender-breakdown">
                                <div class="male-heading">Male: 356</div>
                                <div class="female-heading">Female: 153</div>
                    </div>
                        </div>
                        </div>
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="registeredFamiliesVal">2</div>
                            <small>IVF Cases</small>
                        </div>
                        </div>
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-calculator"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="avgChildrenVal">3</div>
                            <small>Special Child</small>
                    </div>
                </div>
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-heart-broken"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="maritalDiscordVal">2</div>
                            <small>Marital Discord Cases</small>
                    </div>
                        </div>
                    <!-- 
                    ===========================================
                    REFRESH DATA FUNCTIONALITY - TEAM DISCUSSION REQUIRED
                    ===========================================
                    
                    TODO: Discuss with team before implementing in production
                    
                    This refresh button allows users to manually update data from Google Sheets.
                    Consider the following for team discussion:
                    
                    1. SECURITY CONCERNS:
                       - CORS proxy usage (api.allorigins.win) - is this acceptable?
                       - Data privacy when using third-party proxies
                       - Rate limiting and abuse prevention
                    
                    2. PERFORMANCE IMPACT:
                       - Manual refresh vs automatic refresh (currently 5 minutes)
                       - Server load if many users refresh simultaneously
                       - Caching strategy for frequently accessed data
                    
                    3. USER EXPERIENCE:
                       - Should refresh be available to all user types?
                       - Loading states and user feedback
                       - Error handling and fallback messages
                    
                    4. ALTERNATIVE SOLUTIONS:
                       - Server-side data fetching
                       - WebSocket for real-time updates
                       - API integration instead of CSV export
                       - Database backend instead of Google Sheets
                    
                    5. PRODUCTION CONSIDERATIONS:
                       - Remove or modify for production deployment
                       - Implement proper authentication for data access
                       - Add data validation and sanitization
                       - Consider data backup and recovery
                    
                    CURRENT STATUS: Development/Testing Only
                    -->
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-heart"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="healthyFamiliesVal">239</div>
                            <small>Healthy Families (No Medical Issues)</small>
                    </div>
                        </div>
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-user-injured"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="otherMedicalVal">2</div>
                            <small>Other Critical Medical Cases</small>
                        </div>
                        </div>
                    <div class="stat-mini-card">
                        <div class="mini-icon"><i class="fas fa-child"></i></div>
                        <div class="mini-content">
                            <div class="mini-value" id="childrenAgeVal">509</div>
                            <small>Children Age Profile</small>
                            <div class="age-breakdown-grid">
                                <div class="age-group">0-6: 122</div>
                                <div class="age-group">6-12: 216</div>
                                <div class="age-group">12-18: 150</div>
                                <div class="age-group">18-24: 20</div>
                        </div>
                    </div>
                </div>
            </div>
            
                <!-- Enhanced Family Data Charts -->
                <div class="enhanced-charts-section">
                    <h3 class="section-subtitle">Family-Related Analytics</h3>
                    <div class="charts-grid">
                        <!-- Chart 1: Medical Status - Doughnut Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="medicalStatusChart"></canvas>
                        </div>
                            </div>
                    
                        <!-- Chart 2: Parental Education - Horizontal Bar Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="educationChart"></canvas>
                        </div>
                    </div>
                    
                        <!-- Chart 3: Marital Discord - Progress Ring -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="maritalDiscordChart"></canvas>
                        </div>
                            </div>
                    
                        <!-- Chart 4: Workshop Distribution - Bar Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="workshopChart"></canvas>
                        </div>
                    </div>
                    
                        <!-- Chart 5: Entrepreneurship - Gauge Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="entrepreneurshipChart"></canvas>
                        </div>
                    </div>
                    
                        <!-- Chart 6: Family Size Distribution - Polar Area Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="familySizeChart"></canvas>
                        </div>
                            </div>
                        </div>
                    </div>
                    
                <!-- Enhanced Children Data Charts -->
                <div class="enhanced-charts-section">
                    <h3 class="section-subtitle">Children-Related Analytics</h3>
                    <div class="children-charts-grid">
                        <!-- Chart 7: Gender Distribution - Pie Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="genderChart"></canvas>
                </div>
            </div>

                        <!-- Chart 8: Children Age Profile - Polar Area Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="ageProfileChart"></canvas>
                    </div>
                    </div>
                    
                        <!-- Chart 9: Educational Streams - Bar Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="educationalStreamsChart"></canvas>
                </div>
            </div>
            
                        <!-- Chart 10: Medical Needs - Donut Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="medicalNeedsChart"></canvas>
                    </div>
                </div>
            
                        <!-- Chart 11: Children Activities Participation - Bar Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="activitiesParticipationChart"></canvas>
                    </div>
                </div>
            
                        <!-- Chart 12: Children Learning Progress - Bar Chart -->
                        <div class="enhanced-chart-card">
                            <div class="chart-container">
                                <canvas id="learningProgressChart"></canvas>
                    </div>
                </div>
                    </div>
                </div>

    </div>
    
            <!-- Families Section - INTEGRATED WITH GOOGLE SHEETS - TO BE FIXED BY JYOTI AND ADAB -->
            <!-- Data is fetched from: Family Details (Ranbankura Eagles) sheet -->
            <!-- Current implementation has issues with CORS proxy reliability and data mapping -->
    <div class="families-section app-section hidden" id="section-families">
        <div class="section-header-row">
                    <h2>Families <span class="count">(274)</span></h2>
        </div>
        
        <!-- Workshop Filter Buttons -->
        <div class="workshop-filter-section">
            <h4>Filter by Workshop:</h4>
            <div class="workshop-buttons" id="workshopButtons">
                <button class="workshop-btn active" data-workshop="" onclick="filterByWorkshop('')">
                    All Workshops
                </button>
            </div>
        </div>
        
        <!-- Search and Action Buttons -->
            <div class="families-actions">
            <input type="text" class="fam-search" placeholder="Search families..." id="familySearchInput" />
            <button class="check-btn" onclick="console.log('Refresh button clicked'); fetchFamiliesFromGoogleSheets();" id="refreshFamiliesBtn">
                <i class="fas fa-sync-alt"></i> Refresh Data
            </button>
            <button class="check-btn" onclick="toggleAddFamilyForm()" id="addFamilyBtn">
                <i class="fas fa-plus"></i> Add Family
            </button>
            </div>
        
        <!-- Add Family Modal Popup -->
        <div class="modal-overlay hidden" id="addFamilyModal">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-plus"></i>
                        <h3>Add New Family Member</h3>
        </div>
                    <button class="modal-close-btn" onclick="closeAddFamilyModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <form class="add-family-form" id="addFamilyForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyWksp">WKSP *</label>
                                <input type="text" id="familyWksp" name="wksp" required>
                            </div>
                            <div class="form-group">
                                <label for="familyLadiesName">Ladies Name *</label>
                                <input type="text" id="familyLadiesName" name="ladiesName" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyDateOfBirth">Date of Birth</label>
                                <input type="date" id="familyDateOfBirth" name="dateOfBirth">
                            </div>
                            <div class="form-group">
                                <label for="familyAge">Age</label>
                                <input type="number" id="familyAge" name="age" min="0" max="120">
                            </div>
                            <div class="form-group">
                                <label for="familyBloodGroup">Blood Group</label>
                                <select id="familyBloodGroup" name="bloodGroup">
                                    <option value="">Select Blood Group</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyReligion">Religion</label>
                                <input type="text" id="familyReligion" name="religion">
                            </div>
                            <div class="form-group">
                                <label for="familyQualification">Highest Qualification</label>
                                <input type="text" id="familyQualification" name="qualification">
                            </div>
                            <div class="form-group">
                                <label for="familyLanguages">Languages Known</label>
                                <input type="text" id="familyLanguages" name="languages">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyCanDrive">Can Drive</label>
                                <select id="familyCanDrive" name="canDrive">
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="familyOwnsVehicle">Owns Vehicle</label>
                                <select id="familyOwnsVehicle" name="ownsVehicle">
                                    <option value="">Select</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyMobile">Personal Mobile *</label>
                                <input type="tel" id="familyMobile" name="mobile" required>
                            </div>
                            <div class="form-group">
                                <label for="familyEmail">Personal Email</label>
                                <input type="email" id="familyEmail" name="email">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyDateOfMarriage">Date of Marriage</label>
                                <input type="date" id="familyDateOfMarriage" name="dateOfMarriage">
                            </div>
                            <div class="form-group">
                                <label for="familyYearsInMarriage">Years in Marriage</label>
                                <input type="number" id="familyYearsInMarriage" name="yearsInMarriage" min="0" max="100">
                            </div>
                        </div>
                        
                        <!-- Husband's Details -->
                        <div class="form-section-header">
                            <h4>Husband's Details</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyHusbandName">Husband's Name</label>
                                <input type="text" id="familyHusbandName" name="husbandName">
                            </div>
                            <div class="form-group">
                                <label for="familyHusbandRank">Husband's Rank</label>
                                <input type="text" id="familyHusbandRank" name="husbandRank">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyUnit">Unit</label>
                                <input type="text" id="familyUnit" name="unit">
                            </div>
                            <div class="form-group">
                                <label for="familySubUnit">Sub Unit</label>
                                <input type="text" id="familySubUnit" name="subUnit">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyPostingStation">Posting Station</label>
                                <input type="text" id="familyPostingStation" name="postingStation">
                            </div>
                            <div class="form-group">
                                <label for="familyDateOfPosting">Date of Posting</label>
                                <input type="date" id="familyDateOfPosting" name="dateOfPosting">
                            </div>
                        </div>
                        
                        <!-- Accommodation Details -->
                        <div class="form-section-header">
                            <h4>Accommodation Details</h4>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyQuarterNumber">Quarter Number</label>
                                <input type="text" id="familyQuarterNumber" name="quarterNumber">
                            </div>
                            <div class="form-group">
                                <label for="familyColonyName">Colony/Enclave Name</label>
                                <input type="text" id="familyColonyName" name="colonyName">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="familyAccommodationType">Type of Accommodation</label>
                                <input type="text" id="familyAccommodationType" name="accommodationType">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="familyAccommodationAddress">Family Accommodation Address</label>
                                <textarea id="familyAccommodationAddress" name="accommodationAddress" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeAddFamilyModal()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-plus"></i> Add Family
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Family Detail Modal -->
        <div class="modal-overlay hidden" id="familyDetailModal">
            <div class="modal-container family-detail-modal">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-circle"></i>
                        <h3>Family Details</h3>
                    </div>
                    <button class="modal-close-btn" onclick="closeFamilyDetailModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body family-detail-body">
                    <div class="family-detail-content" id="familyDetailContent">
                        <!-- Family details will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="families-grid" id="familiesGrid"></div>
    </div>

            <!-- Workshop Data Section -->
    <div class="workshop-section app-section hidden" id="section-companies">
        <div class="section-header-row">
            <h2>624 Sub Units <span class="count" id="workshopCount">(0)</span></h2>
        </div>
        
        <!-- FW Coy Analytics Summary -->
        <div class="fw-coy-analytics">
            <div class="analytics-summary">
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="totalUnits">0</div>
                        <div class="summary-label">Total 624 Sub Units</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="totalFamilies">0</div>
                        <div class="summary-label">Total Families</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="avgFamiliesPerUnit">0</div>
                        <div class="summary-label">Avg Families/Unit</div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-value" id="largestUnit">-</div>
                        <div class="summary-label">Largest Unit</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FW Coy Filters and Controls -->
        <div class="fw-coy-controls">
            <div class="filter-section">
                <div class="filter-group">
                    <label>Filter by Type:</label>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="FWC">FWC</button>
                        <button class="filter-btn" data-filter="AW">AW</button>
                        <button class="filter-btn" data-filter="BHQ">BHQ</button>
                    </div>
                </div>
                <div class="sort-group">
                    <label>Sort by:</label>
                    <select id="fwCoySortSelect" class="sort-select">
                        <option value="count-desc">Families (High to Low)</option>
                        <option value="count-asc">Families (Low to High)</option>
                        <option value="name-asc">Unit Name (A-Z)</option>
                        <option value="name-desc">Unit Name (Z-A)</option>
                    </select>
                </div>
            </div>
        </div>


        <div class="workshop-grid" id="workshopGrid"></div>
    </div>

    <!-- Unit Details Modal -->
    <div class="unit-detail-modal" id="unitDetailModal">
        <div class="unit-detail-content">
            <div class="unit-detail-header">
                <h2 class="unit-detail-title" id="unitDetailTitle">Unit Details</h2>
                <button class="unit-detail-close" onclick="closeUnitDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="unit-detail-body" id="unitDetailBody">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>

            <!-- Newsletter Section -->
    <div class="newsletter-section app-section hidden" id="section-Newsletter">
        <div class="section-header-row">
            </div>
        
        <!-- Newsletter Title Section -->
        <div class="newsletter-title-section">
            <h1 class="newsletter-bilingual-title">Sainika Shakti Utthaan Patrika | सैनिका शक्ति उत्थान पत्रिका</h1>
            <h2 class="newsletter-description">A Monthly Newsletter of FWO Ranbankura Eagles</h2>
            <div class="newsletter-action-buttons">
                <!-- <button class="newsletter-send-btn" id="newsletterSendBtn" onclick="sendNewsletter()">
                    <i class="fas fa-paper-plane"></i>
                    <span>Send Newsletter</span>
                </button> -->
        </div>
        </div>
        <!-- Newsletter Analytics -->
        <div class="newsletter-analytics">
            <h3>Newsletter Analytics - September 2025</h3>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="analytics-content">
                        <div class="analytics-value" id="totalSubscribers">260</div>
                        <div class="analytics-label">Total Subscribers</div>
                        <div class="analytics-change positive">+8% this month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">
                        <i class="fas fa-envelope-open"></i>
                    </div>
                    <div class="analytics-content">
                        <div class="analytics-value" id="openRate">72.3%</div>
                        <div class="analytics-label">Open Rate</div>
                        <div class="analytics-change positive">+2.1% vs last month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">
                        <i class="fas fa-mouse-pointer"></i>
                    </div>
                    <div class="analytics-content">
                        <div class="analytics-value" id="clickRate">28.7%</div>
                        <div class="analytics-label">Click Rate</div>
                        <div class="analytics-change positive">+1.5% vs last month</div>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <div class="analytics-icon">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <div class="analytics-content">
                        <div class="analytics-value" id="lastSent">3</div>
                        <div class="analytics-label">Newsletters Sent</div>
                        <div class="analytics-change neutral">This month</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Newsletter Benefits Section -->
        <div class="newsletter-benefits">
            <h3>What You'll Get</h3>
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="benefit-content">
                        <h4>Monthly Digest</h4>
                        <p>Comprehensive overview of AWWA activities, achievements, and upcoming events</p>
                    </div>
                </div>
                
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="benefit-content">
                        <h4>Workshop Updates</h4>
                        <p>Early notifications about skill development workshops and training programs</p>
                    </div>
                </div>
                
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="benefit-content">
                        <h4>Community Stories</h4>
                        <p>Inspiring success stories and achievements from our AWWA family members</p>
                    </div>
                </div>
                
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-hands-helping"></i>
                    </div>
                    <div class="benefit-content">
                        <h4>Volunteer Opportunities</h4>
                        <p>Exclusive access to community service and volunteer opportunities</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Newsletter Charts Section -->
        <div class="newsletter-charts-section">
            <h3 class="section-subtitle">Newsletter Performance - September 2025</h3>
            <div class="newsletter-charts-grid">
                <!-- Chart 1: Newsletter Opens Over Time -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="newsletterOpensChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 2: Click Rate by Newsletter Type -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="newsletterClickRateChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 3: Subscriber Growth -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="subscriberGrowthChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 4: Engagement by Day of Week -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="engagementByDayChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 5: Newsletter Content Performance -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="contentPerformanceChart"></canvas>
                    </div>
                </div>
                
                <!-- Chart 6: Unsubscribe Rate Trend -->
                <div class="enhanced-chart-card">
                    <div class="chart-container">
                        <canvas id="unsubscribeRateChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="newsletter-grid">
            <div class="newsletter-card">
                <h3>Subscribe to AWWA Updates</h3>
                <p class="subtext">Get monthly highlights, events, and community stories right in your inbox.</p>
                <form id="newsletterForm" class="newsletter-form">
                    <div class="form-row">
                        <label for="nlName">Full name</label>
                        <input type="text" id="nlName" placeholder="Enter your name" required>
                    </div>
                    <div class="form-row">
                        <label for="nlEmail">Email address</label>
                        <input type="email" id="nlEmail" placeholder="you@example.com" required>
                    </div>
                    <div class="form-row inline">
                        <input type="checkbox" id="nlConsent" required>
                        <label for="nlConsent">I agree to receive newsletters and understand I can unsubscribe anytime.</label>
                    </div>
                    <button type="submit" class="check-btn wide">Subscribe</button>
                    <p id="nlMessage" class="nl-message" aria-live="polite"></p>
                </form>
            </div>
        </div>
    </div>

            <!-- Power BI Section -->
    <div class="powerbi-section app-section hidden" id="section-reports">
        <div class="section-header-row">
            <h2>Analytics (Power BI)</h2>
            <div class="families-actions">
                <a href="https://learn.microsoft.com/power-bi/collaborate-share/service-publish-to-web" target="_blank" class="check-btn">How to get embed link</a>
            </div>
        </div>
        <div class="powerbi-grid">
            <div class="powerbi-config">
                <h3>Embed your report</h3>
                <p class="subtext">Paste a Power BI "Publish to web" URL (starts with https://app.powerbi.com/view?...). We'll remember it for you.</p>
                <div class="form-row">
                    <label for="pbiUrl">Power BI public embed URL</label>
                    <input id="pbiUrl" type="url" placeholder="https://app.powerbi.com/view?r=..." />
                </div>
                <div class="form-row inline">
                    <button id="pbiLoadBtn" class="check-btn">Load report</button>
                    <button id="pbiClearBtn" class="copy-btn" type="button">Clear</button>
                </div>
                <small>Note: For secure embeds (Embed for your organization) you'll need a backend to generate an access token. This UI supports public "Publish to web" links for quick demos.</small>
            </div>
            <div class="powerbi-view">
                <div class="pbi-frame-wrap">
                    <iframe id="pbiFrame" title="Power BI Report" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>

            <!-- Rankings Section -->
    <div class="ranking-section app-section hidden" id="section-Rankings">
        <div class="section-header-row">
            <h2>Admin Users</h2>
        </div>
        <div class="ranking-grid">
            <div class="rank-card">
                <div class="rank-left">
                    <div class="rank-badge">1</div>
                    <img src="public/Gemini_Generated_Image_4jitd24jitd24jit.png" alt="Col Tarunpreet Singh" class="rank-avatar-img" />
                </div>
                <div class="rank-info">
                    <div class="rank-title">Rank - Col</div>
                    <h3 class="rank-name">Tarunpreet Singh</h3>
                    <div class="rank-role">Commanding Officer</div>
                    <a href="tel:9650300475" class="rank-phone">Mob No: 9650300475</a>
                </div>
            </div>

            <div class="rank-card">
                <div class="rank-left">
                    <div class="rank-badge">2</div>
                            <img src="public/piyush.jpeg" alt="Lt Col Piyush Sharma" class="rank-avatar-img" />
                </div>
                <div class="rank-info">
                    <div class="rank-title">Rank - Lt Col</div>
                    <h3 class="rank-name">Piyush Sharma</h3>
                    <div class="rank-role">Second in Comd</div>
                    <a href="tel:9797719357" class="rank-phone">Mobile No: 9797719357</a>
                </div>
            </div>

            <div class="rank-card">
                <div class="rank-left">
                    <div class="rank-badge">3</div>
                            <img src="public/harish.jpeg" alt="Maj Harish Kumar" class="rank-avatar-img" />
                </div>
                <div class="rank-info">
                    <div class="rank-title">Rank - Maj</div>
                    <h3 class="rank-name">Harish Kumar</h3>
                    <div class="rank-role">Adjt</div>
                    <a href="tel:9256172418" class="rank-phone">Mob No: 9256172418</a>
                </div>
            </div>

            <div class="rank-card">
                <div class="rank-left">
                    <div class="rank-badge">4</div>
                            <img src="public/Rahul.jpeg" alt="Lt Col Rahul T More" class="rank-avatar-img" />
                </div>
                <div class="rank-info">
                    <div class="rank-title">Rank - Lt Col</div>
                    <h3 class="rank-name">Rahul T More</h3>
                    <div class="rank-role">OIC Tech Cell</div>
                    <a href="tel:7006216984" class="rank-phone">Mobile No: 7006216984</a>
                </div>
            </div>
        </div>
    </div>

            <!-- About Section - DISABLED -->
    <!--
    <div class="about-section app-section hidden" id="section-about">
        <div class="section-header-row">
            <h2>About</h2>
        </div>
        
        <div class="about-content">
            <div class="about-card">
                <div class="about-brochure">
                    <h4><i class="fas fa-file-pdf"></i> Organization Brochure</h4>
                    <div class="brochure-container" onclick="openBrochureModal()">
                        <div class="brochure-images">
                            <img src="https://via.placeholder.com/400x280/ff8c00/ffffff?text=Brochure+Page+1" alt="Brochure Page 1" class="brochure-image brochure-left" />
                            <img src="https://via.placeholder.com/400x280/ff9500/ffffff?text=Brochure+Page+2" alt="Brochure Page 2" class="brochure-image brochure-right" />
                        </div>
                        <div class="brochure-overlay">
                            <i class="fas fa-expand"></i>
                            <span>Click to view full brochure</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay hidden" id="brochureModal">
        <div class="modal-container brochure-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-file-pdf"></i>
                    <h3>Ranbankura Eagles FWO - Organization Brochure</h3>
                </div>
                <button class="modal-close-btn" onclick="closeBrochureModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="brochure-modal-content">
                    <img src="https://via.placeholder.com/600x800/ff8c00/ffffff?text=Brochure+Page+1" alt="Brochure Page 1" class="brochure-modal-image" />
                    <img src="https://via.placeholder.com/600x800/ff9500/ffffff?text=Brochure+Page+2" alt="Brochure Page 2" class="brochure-modal-image" />
                </div>
            </div>
        </div>
    </div>
    -->

        </div>
    </div>

    <script>
        /*
        ===========================================
        GOOGLE SHEETS DATA INTEGRATION - SUPER USER
        ===========================================
        
        This script integrates real family data from Google Sheets for super users:
        https://docs.google.com/spreadsheets/d/1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw/edit?usp=sharing
        
        SUPER USER FEATURES:
        - Enhanced data visualization with additional analytics
        - Advanced filtering and search capabilities
        - Detailed family information display
        - Export functionality for reports
        - Real-time data synchronization
        - Advanced chart interactions
        */

      
        
        // Google Sheets integration configuration (same as main dashboard)
        const GOOGLE_SHEETS_CONFIG = {
            sheetId: '1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw',
            csvUrl: 'https://docs.google.com/spreadsheets/d/1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw/export?format=csv&gid=0',
            refreshInterval: 300000 // 5 minutes
        };
        
        // Global data storage for super user
        let realFamilyData = [];
        let dataStats = {
            totalFamilies: 0,
            totalChildren: 0,
            registeredFamilies: 0,
            workshopDistribution: {},
            bloodGroupDistribution: {},
            religionDistribution: {},
            ageDistribution: {},
            medicalStatus: {},
            educationLevels: {},
            accommodationTypes: {},
            // Super user specific stats
            specialChildren: 0,
            ivfCases: 0,
            dependents: 0,
            vehicleOwners: 0,
            drivers: 0
        };
        
        /*
        ===========================================
        GOOGLE SHEETS DATA FETCHING - TEAM DISCUSSION REQUIRED
        ===========================================
        
        TODO: Discuss with team before implementing in production
        
        This function fetches data from Google Sheets using multiple methods:
        1. CORS proxy (api.allorigins.win) - bypasses browser CORS restrictions
        2. Direct fetch - may fail due to CORS
        3. Fallback data - sample data if both methods fail
        
        SECURITY CONCERNS FOR TEAM DISCUSSION:
        - Using third-party CORS proxy (api.allorigins.win)
        - Data privacy and security implications
        - Rate limiting and abuse prevention
        - Alternative solutions for production
        
        CURRENT STATUS: Development/Testing Only
        */
        // Function to fetch data from Google Sheets (enhanced for super user)
        async function fetchGoogleSheetsData() {
            console.log('🔄 fetchGoogleSheetsData called - using NEW CORS proxy array');
            try {
                console.log('Fetching data from Google Sheets (Super User)...');
                updateDataStatus('Fetching data...', 'loading');
                
                // Try multiple methods to fetch the data
                let csvText = '';
                
                // Method 1: Try multiple CORS proxies
                let proxyIndex = 0;
                let success = false;
                
                while (proxyIndex < CORS_PROXIES.length && !success) {
                    try {
                        const proxyUrl = CORS_PROXIES[proxyIndex] + encodeURIComponent(GOOGLE_SHEETS_CONFIG.csvUrl);
                        console.log(`Trying CORS proxy ${proxyIndex + 1}:`, CORS_PROXIES[proxyIndex]);
                        
                        const response = await fetch(proxyUrl);
                        
                        if (response.ok) {
                            csvText = await response.text();
                            console.log(`Data fetched via proxy ${proxyIndex + 1} successfully`);
                            success = true;
                        } else {
                            console.log(`Proxy ${proxyIndex + 1} failed:`, response.status);
                            proxyIndex++;
                        }
                    } catch (proxyError) {
                        console.log(`Proxy ${proxyIndex + 1} error:`, proxyError.message);
                        proxyIndex++;
                    }
                }
                
                if (!success) {
                    console.log('All CORS proxies failed, trying direct fetch...');
                    
                    // Method 2: Direct fetch (might fail due to CORS)
                    try {
                        const response = await fetch(GOOGLE_SHEETS_CONFIG.csvUrl);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        csvText = await response.text();
                        console.log('Data fetched directly successfully');
                    } catch (directError) {
                        console.log('Direct fetch failed, using fallback data...', directError);
                        throw new Error('Both proxy and direct fetch failed');
                    }
                }
                
                if (csvText && csvText.trim()) {
                    const parsedData = parseCSVData(csvText);
                    
                    if (parsedData.length > 0) {
                        realFamilyData = parsedData;
                        updateDataStatistics();
                        updateDashboardWithRealData();
                        
                        console.log('Data fetched successfully:', realFamilyData.length, 'families');
                        updateDataStatus(`Last updated: ${new Date().toLocaleTimeString()}`, 'success');
                        return true;
                    } else {
                        throw new Error('No data parsed from CSV');
                    }
                } else {
                    throw new Error('Empty response from server');
                }
                
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
                updateDataStatus('Using fallback data', 'error');
                useFallbackData();
                return false;
            }
        }
        
        // Enhanced data statistics for super user
        function updateDataStatistics() {
            dataStats.totalFamilies = realFamilyData.length;
            dataStats.totalChildren = 0;
            dataStats.specialChildren = 0;
            dataStats.ivfCases = 0;
            dataStats.dependents = 0;
            dataStats.vehicleOwners = 0;
            dataStats.drivers = 0;
            dataStats.workshopDistribution = {};
            dataStats.bloodGroupDistribution = {};
            dataStats.religionDistribution = {};
            dataStats.ageDistribution = {};
            dataStats.medicalStatus = { 'No Issues': 0, 'Has Issues': 0, 'Other': 0 };
            dataStats.educationLevels = {};
            dataStats.accommodationTypes = {};
            
            realFamilyData.forEach(family => {
                // Count children and special cases
                if (family['Child 1 Name'] && family['Child 1 Name'].trim()) {
                    dataStats.totalChildren++;
                    if (family['Special Child'] && family['Special Child'].toLowerCase() === 'yes') {
                        dataStats.specialChildren++;
                    }
                }
                if (family['Child 2 Name'] && family['Child 2 Name'].trim()) {
                    dataStats.totalChildren++;
                    if (family['Special Child'] && family['Special Child'].toLowerCase() === 'yes') {
                        dataStats.specialChildren++;
                    }
                }
                if (family['Child 3 Name'] && family['Child 3 Name'].trim()) {
                    dataStats.totalChildren++;
                    if (family['Special Child'] && family['Special Child'].toLowerCase() === 'yes') {
                        dataStats.specialChildren++;
                    }
                }
                
                // Count IVF cases
                if (family['IVF Case'] && family['IVF Case'].toLowerCase() === 'yes') {
                    dataStats.ivfCases++;
                }
                
                // Count dependents
                if (family['Dependent 1 Name'] && family['Dependent 1 Name'].trim()) dataStats.dependents++;
                if (family['Dependent 2 Name'] && family['Dependent 2 Name'].trim()) dataStats.dependents++;
                
                // Count vehicle owners and drivers
                if (family['Owns Vehicle'] && family['Owns Vehicle'].toLowerCase() === 'yes') dataStats.vehicleOwners++;
                if (family['Can Drive'] && family['Can Drive'].toLowerCase() === 'yes') dataStats.drivers++;
                
                // Workshop distribution
                const workshop = family['WKSP'] || 'Unknown';
                dataStats.workshopDistribution[workshop] = (dataStats.workshopDistribution[workshop] || 0) + 1;
                
                // Blood group distribution
                const bloodGroup = family['Blood Group'] || 'Unknown';
                dataStats.bloodGroupDistribution[bloodGroup] = (dataStats.bloodGroupDistribution[bloodGroup] || 0) + 1;
                
                // Religion distribution
                const religion = family['Religion'] || 'Unknown';
                dataStats.religionDistribution[religion] = (dataStats.religionDistribution[religion] || 0) + 1;
                
                // Age distribution
                const age = parseInt(family['Age']) || 0;
                if (age > 0) {
                    const ageGroup = age < 30 ? 'Under 30' : age < 50 ? '30-50' : 'Over 50';
                    dataStats.ageDistribution[ageGroup] = (dataStats.ageDistribution[ageGroup] || 0) + 1;
                }
                
                // Medical status
                const hasMedicalIssues = family['Disease'] && family['Disease'].trim() !== '-' && family['Disease'].trim() !== '';
                if (hasMedicalIssues) {
                    dataStats.medicalStatus['Has Issues']++;
                } else {
                    dataStats.medicalStatus['No Issues']++;
                }
                
                // Education levels
                const education = family['Highest Qualification'] || 'Unknown';
                dataStats.educationLevels[education] = (dataStats.educationLevels[education] || 0) + 1;
                
                // Accommodation types
                const accommodation = family['Type of Accommodation'] || 'Unknown';
                dataStats.accommodationTypes[accommodation] = (dataStats.accommodationTypes[accommodation] || 0) + 1;
            });
            
            dataStats.registeredFamilies = dataStats.totalFamilies;
        }
        
        // Function to update data status indicator
        function updateDataStatus(message, status) {
            const statusElement = document.getElementById('dataStatus');
            const refreshBtn = document.getElementById('refreshDataBtn');
            
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `data-status ${status}`;
            }
            
            if (refreshBtn) {
                if (status === 'loading') {
                    refreshBtn.disabled = true;
                    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                } else {
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
                }
            }
        }
        
        // CSV parsing functions (same as main dashboard)
        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 3; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length > 0) {
                        const family = {};
                        headers.forEach((header, index) => {
                            family[header] = values[index] || '';
                        });
                        data.push(family);
                    }
                }
            }
            
            return data;
        }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }
        
        // Function to update dashboard with real data
        function updateDashboardWithRealData() {
            // Keep all dashboard values as original static values
            // No dynamic updates to statistics cards or charts
            console.log('Dashboard maintaining original static values');
        }
        
        // Function to update charts with real data
        function updateChartsWithRealData() {
            if (window.__chartsReady) {
                // Keep original chart values - only update statistics cards
                // Charts will maintain their original static values
                console.log('Charts maintaining original values');
            }
        }
        
        // Simple refresh function for dashboard
        function refreshDashboard() {
            console.log('Refreshing dashboard with static values');
            updateDataStatus('Dashboard refreshed', 'success');
            
            // Just refresh the page to show any visual updates
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
        
        // Charts will maintain their original static values as requested
        // No dynamic data updates for chart values
        
        // Chart update functions - keeping original values
        // Charts will maintain their original static values as requested
        
        // Fallback data function
        function useFallbackData() {
            console.log('Using fallback data...');
            
            // Sample data based on your Google Sheets structure
            realFamilyData = [
                {
                    'WKSP': 'BHQ',
                    'Ladies Name': 'Smt Rajni Devi',
                    'Date of Birth': '1998-05-08',
                    'Age': '32',
                    'Blood Group': 'AB+',
                    'Religion': 'Muslim',
                    'Highest Qualification': 'MA Bed',
                    'Can Drive': 'Yes',
                    'Owns Vehicle': 'No',
                    'Personal Mobile': '9465089669',
                    'Husband\'s Name': 'Sub Manjit Singh',
                    'Husband\'s Rank': 'SUB',
                    'Child 1 Name': 'Kirti Thakur',
                    'Child 1 Age': '23',
                    'Child 1 Class': 'BSC 2nd',
                    'Disease': '-',
                    'Type of Accommodation': 'P4/10 Old Umrao',
                    'Special Child': 'Yes',
                    'IVF Case': 'No',
                    'Dependent 1 Name': '',
                    'Dependent 2 Name': ''
                },
                {
                    'WKSP': '265 FWC',
                    'Ladies Name': 'Smt P Keerthi',
                    'Date of Birth': '1972-03-01',
                    'Age': '58',
                    'Blood Group': 'AB+',
                    'Religion': 'Muslim',
                    'Highest Qualification': 'BSc',
                    'Can Drive': 'Yes',
                    'Owns Vehicle': 'Yes',
                    'Personal Mobile': '7903895195',
                    'Husband\'s Name': 'Hav Praveen Kumar',
                    'Husband\'s Rank': 'HAV',
                    'Child 1 Name': 'Vaishnavi Mehta',
                    'Child 1 Age': '10th',
                    'Child 1 Class': '10th',
                    'Child 2 Name': 'Shaurya Mehta',
                    'Child 2 Age': '6th',
                    'Child 2 Class': '6th',
                    'Disease': '-',
                    'Type of Accommodation': 'P-395/03, Karam Singh Enclave',
                    'Special Child': 'Yes',
                    'IVF Case': 'No',
                    'Dependent 1 Name': '',
                    'Dependent 2 Name': ''
                },
                {
                    'WKSP': '265 FWC',
                    'Ladies Name': 'Smt Reetika Devi',
                    'Date of Birth': '1996-05-10',
                    'Age': '24',
                    'Blood Group': 'B+',
                    'Religion': 'Sikh',
                    'Highest Qualification': 'MA , BEd',
                    'Can Drive': 'Yes',
                    'Owns Vehicle': 'No',
                    'Personal Mobile': '7668428667',
                    'Husband\'s Name': 'HMT Akash Kumar',
                    'Husband\'s Rank': 'HMT',
                    'Child 1 Name': 'Kush',
                    'Child 1 Age': '-',
                    'Child 1 Class': '-',
                    'Disease': '-',
                    'Type of Accommodation': '15/03, Bana Singh Enclave',
                    'Special Child': 'Yes',
                    'IVF Case': 'No',
                    'Dependent 1 Name': '',
                    'Dependent 2 Name': ''
                }
            ];
            
            updateDataStatistics();
            updateDashboardWithRealData();
            updateDataStatus('Using sample data', 'error');
        }
        
        // Chart responsiveness and resizing functions
        function makeChartsResponsive() {
            // Add resize event listener for charts
            window.addEventListener('resize', function() {
                Chart.helpers.each(Chart.instances, function(chart) {
                    chart.resize();
                });
            });
            
            // Add chart hover effects
            const chartCards = document.querySelectorAll('.enhanced-chart-card');
            chartCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                    this.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
                });
            });
        }
        
        // Function to update chart sizes based on container
        function updateChartSizes() {
            if (typeof Chart === 'undefined' || !Chart.instances) {
                console.log('Chart.js not available or no instances');
                return;
            }
            
            // Chart.instances is an object, not an array
            const chartInstances = Object.values(Chart.instances);
            chartInstances.forEach(chart => {
                if (chart && chart.canvas && chart.canvas.parentElement) {
                    const container = chart.canvas.parentElement;
                    const containerWidth = container.clientWidth;
                    const containerHeight = container.clientHeight;
                    
                    // Set optimal chart size based on container
                    if (containerWidth < 300) {
                        if (chart.options && chart.options.plugins && chart.options.plugins.legend) {
                            chart.options.plugins.legend.position = 'bottom';
                        }
                        if (chart.options && chart.options.plugins && chart.options.plugins.title) {
                            chart.options.plugins.title.font.size = 14;
                        }
                    } else if (containerWidth < 500) {
                        if (chart.options && chart.options.plugins && chart.options.plugins.legend) {
                            chart.options.plugins.legend.position = 'bottom';
                        }
                        if (chart.options && chart.options.plugins && chart.options.plugins.title) {
                            chart.options.plugins.title.font.size = 16;
                        }
                    } else {
                        if (chart.options && chart.options.plugins && chart.options.plugins.legend) {
                            chart.options.plugins.legend.position = 'right';
                        }
                        if (chart.options && chart.options.plugins && chart.options.plugins.title) {
                            chart.options.plugins.title.font.size = 18;
                        }
                    }
                    
                    chart.update('none');
                }
            });
        }
        
        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Keep all values static - no data fetching
            console.log('Dashboard initialized with static values');
            
            // Initialize families count on page load
            initializeFamiliesCount();
            
            // Initialize chart responsiveness
            setTimeout(makeChartsResponsive, 1000);
            setTimeout(updateChartSizes, 1500);
        });
        
        // Enhanced Charts: initialize on first view of dashboard
async function initChartsOnce() {
  if (window.__chartsReady) return;
  
  // Check if Chart.js is loaded
  if (typeof Chart === 'undefined') {
    console.error('Chart.js not loaded');
    return;
  }
  
  console.log('Initializing dashboard charts...');
  
            // Color palettes for different chart types
            const colorPalettes = {
                medical: ['#ff8c00', '#ff9500', '#ffa500'],
                education: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347', '#ff7f00'],
                gender: ['#ff8c00', '#ffa500', '#ffb347'],
                workshop: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347', '#ff7f00', '#ff6b35', '#ff8c42'],
                age: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347'],
                health: ['#ff8c00', '#ff6b35']
            };

            // Chart 1: Family Medical Status - Doughnut Chart
            new Chart(document.getElementById('medicalStatusChart'), {
                type: 'doughnut',
    data: {
                    labels: ['No Issues', 'Has Issues', 'Other'],
      datasets: [{
                        data: [239, 30, 2],
                        backgroundColor: ['#8B4513', '#D2691E', '#CD853F'],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 25,
                        hoverBackgroundColor: ['#A0522D', '#B8860B', '#DEB887']
      }]
    },
    options: {
      responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
      plugins: { 
          title: {
            display: true,
                            text: 'Family Medical Status',
                            font: { size: 16, weight: 'bold' },
                            color: '#1F2937',
                            padding: 20
                        },
                        legend: {
                            position: 'bottom',
                            labels: { 
                                font: { size: 11, weight: '500' },
                                padding: 15,
                                usePointStyle: true,
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '65%',
                    animation: { 
                        duration: 1500,
                        easing: 'easeInOutQuart',
                        animateRotate: true
                    }
                }
            });

            // Chart 2: Parental Education - Horizontal Bar Chart
            new Chart(document.getElementById('educationChart'), {
    type: 'bar',
    data: {
                    labels: ['Post Graduate', 'Graduation', '12th Grade', '10th Grade', 'Other'],
      datasets: [{
                        label: 'Number of Families',
                        data: [23, 72, 97, 32, 15],
                        backgroundColor: colorPalettes.education,
                        borderRadius: 8,
                        borderSkipped: false,
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverBackgroundColor: colorPalettes.education.map(color => color + 'CC'),
                        hoverBorderWidth: 3
      }]
    },
    options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Parental Education Level',
                            font: { size: 16, weight: 'bold' },
                            color: '#1F2937',
                            padding: 20
                        },
                        legend: { display: false },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.x} families`;
                                }
                            }
                        }
                    },
      scales: { 
                        x: { 
                            beginAtZero: true, 
                            grid: { display: false },
                            ticks: {
                                font: { size: 11 },
                                color: '#6B7280'
                            }
                        },
                        y: { 
                            grid: { display: false },
                            ticks: {
                                font: { size: 11 },
                                color: '#6B7280'
                            }
                        }
                    },
                    animation: { 
                        duration: 1500,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Chart 3: Marital Discord - Progress Ring
            new Chart(document.getElementById('maritalDiscordChart'), {
                type: 'doughnut',
    data: {
                    labels: ['No Discord', 'Discord Present'],
      datasets: [{
                        data: [250, 24],
                        backgroundColor: ['#ff8c00', '#ff6b35'],
                        borderWidth: 0,
                        hoverOffset: 20
      }]
    },
    options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Marital Discord Status',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    cutout: '70%',
                    animation: { duration: 2000 }
                }
            });

            // Chart 4: Workshop Distribution - Bar Chart
            new Chart(document.getElementById('workshopChart'), {
    type: 'bar',
    data: {
                    labels: ['288 AW', '832 FWC', '831 FWC', '265 FWC', 'BHQ', '290 FWC', '286 FWC'],
      datasets: [{
                        label: 'Number of Families',
                        data: [65, 60, 38, 36, 30, 23, 22],
                        backgroundColor: colorPalettes.workshop,
                        borderRadius: 8,
                        borderSkipped: false
      }]
    },
    options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
          title: {
            display: true,
                            text: 'Distribution of Family Members',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: { display: false }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: { beginAtZero: true, grid: { display: false } }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 5: Entrepreneurship - Gauge Chart
            new Chart(document.getElementById('entrepreneurshipChart'), {
    type: 'doughnut',
    data: {
                    labels: ['Not Involved', 'Involved'],
      datasets: [{
                        data: [269, 5],
                        backgroundColor: ['#ffb347', '#ff8c00'],
                        borderWidth: 0,
                        hoverOffset: 20
      }]
    },
    options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
          title: {
            display: true,
                            text: 'AWWA Entrepreneurship Program',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    cutout: '80%',
                    animation: { duration: 2000 }
                }
            });

            // Chart 6: Family Size Distribution - Polar Area Chart
            new Chart(document.getElementById('familySizeChart'), {
                type: 'polarArea',
    data: {
                    labels: ['1 Child', '2 Children', '3 Children', '4+ Children'],
      datasets: [{
                        data: [45, 78, 32, 15],
                        backgroundColor: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347'],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
      }]
    },
    options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
          title: {
            display: true,
                            text: 'Family Size Distribution',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 7: Gender Distribution - Pie Chart
            new Chart(document.getElementById('genderChart'), {
                type: 'pie',
    data: {
                    labels: ['Male', 'Female'],
      datasets: [{
                        data: [33, 14],
                        backgroundColor: ['#ff8c00', '#ffa500'],
                        borderWidth: 3,
                        borderColor: '#FFFFFF',
                        hoverOffset: 20
      }]
    },
    options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
          title: {
            display: true,
                            text: 'Children Gender Distribution',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 8: Children Age Profile - Polar Area Chart
            new Chart(document.getElementById('ageProfileChart'), {
                type: 'polarArea',
    data: {
                    labels: ['0-6 years', '6-12 years', '12-18 years', '18-24 years'],
      datasets: [{
                        data: [45, 78, 52, 8],
                        backgroundColor: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347'],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
      }]
    },
    options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
          title: {
            display: true,
                            text: 'Children Age Profile',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 9: Educational Streams - Bar Chart
            new Chart(document.getElementById('educationalStreamsChart'), {
    type: 'bar',
    data: {
                    labels: ['Arts', 'Commerce', 'Science', 'PCM', 'PCB', 'Other'],
      datasets: [{
                        label: 'Number of Students',
                        data: [15, 8, 12, 6, 4, 25],
                        backgroundColor: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347', '#ff7f00', '#ff6b35'],
                        borderRadius: 8,
                        borderSkipped: false
      }]
    },
    options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
              title: {
                display: true,
                            text: 'Educational Streams Distribution',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: { display: false }
                    },
      scales: { 
            x: { 
              grid: { display: false },
                            ticks: { font: { size: 11 } }
                        },
        y: { 
          beginAtZero: true,
                            grid: { display: false },
                            ticks: { stepSize: 5 }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 10: Medical Needs - Donut Chart
            new Chart(document.getElementById('medicalNeedsChart'), {
    type: 'doughnut',
    data: {
                    labels: ['No Special Needs', 'Special Needs'],
      datasets: [{
                        data: [269, 3],
                        backgroundColor: ['#8B4513', '#D2691E'],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 25,
                        hoverBackgroundColor: ['#A0522D', '#B8860B']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Children Medical Needs',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        }
                    },
                    cutout: '60%',
                    animation: { duration: 2000 }
                }
            });

            // Chart 11: Children Activities Participation - Bar Chart
            new Chart(document.getElementById('activitiesParticipationChart'), {
                type: 'bar',
                data: {
                    labels: ['Sports', 'Arts & Crafts', 'Music', 'Dance', 'Reading', 'Games'],
                    datasets: [{
                        data: [85, 72, 58, 91, 67, 78],
                        backgroundColor: ['#8B4513', '#D2691E', '#CD853F', '#A0522D', '#B8860B', '#DEB887'],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        borderRadius: 8,
                        hoverBackgroundColor: ['#A0522D', '#B8860B', '#DEB887', '#8B4513', '#D2691E', '#CD853F']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Children Activities Participation',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { stepSize: 10 }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            // Chart 12: Children Learning Progress - Bar Chart
            new Chart(document.getElementById('learningProgressChart'), {
                type: 'bar',
                data: {
                    labels: ['Excellent', 'Good', 'Average', 'Needs Improvement', 'Below Average'],
                    datasets: [{
                        data: [45, 78, 92, 34, 12],
                        backgroundColor: ['#8B4513', '#D2691E', '#CD853F', '#A0522D', '#B8860B'],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        borderRadius: 8,
                        hoverBackgroundColor: ['#A0522D', '#B8860B', '#DEB887', '#8B4513', '#D2691E']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Children Learning Progress',
                            font: { size: 18, weight: 'bold' },
                            color: '#1F2937'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { stepSize: 10 }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    animation: { duration: 2000 }
                }
            });

            window.__chartsReady = true;
            console.log('Dashboard charts initialized successfully!');
        }

        // Navigation functionality
        function switchSection(targetSection) {
            // Hide all sections
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show target section
            const target = document.getElementById(targetSection);
            if (target) {
                target.classList.remove('hidden');
            }
            
            // Update navigation active state
            document.querySelectorAll('.lp-nav li').forEach(li => {
                li.classList.remove('active');
            });
            
            const activeNav = document.querySelector(`.lp-nav li[data-target="${targetSection}"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
        }

        const GOOGLE_SHEET_ID = '1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw';
        const GOOGLE_SHEET_NAME = 'Family Details (Ranbankura Eagles)';
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        
        // IMPORTANT: Replace this with your actual Google Sheets API key
        // To get an API key:
        // 1. Go to Google Cloud Console (https://console.cloud.google.com/)
        // 2. Create a new project or select existing one
        // 3. Enable Google Sheets API
        // 4. Create credentials (API Key)
        // 5. Restrict the key to Google Sheets API and your domain
         const GOOGLE_API_KEY = 'AIzaSyDU-P_oFoohdg6c0yCU3_nWczb3WDiNlPE';
        // CORS ISSUE SOLUTION:
        // If you're getting CORS errors, you have several options:
        // 1. Use a local server (recommended for development):
        //    - Install Python: python -m http.server 8000
        //    - Or use Live Server extension in VS Code
        //    - Access via http://localhost:8000 instead of file://
        // 2. Use a CORS browser extension (for testing only)
        // 3. Deploy to a web server (production solution)
        // 4. Use Google Apps Script as a proxy (see below)
        
        // Simple CORS bypass using JSONP-like approach
        function addFamilyViaJSONP(familyData) {
            return new Promise((resolve, reject) => {
                // Create a form and submit it to a CORS proxy
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = 'https://corsproxy.io/?https://sheets.googleapis.com/v4/spreadsheets/' + GOOGLE_SHEET_ID + '/values/' + encodeURIComponent(GOOGLE_SHEET_NAME) + ':append?valueInputOption=USER_ENTERED&key=' + GOOGLE_API_KEY;
                form.target = '_blank';
                
                const dataInput = document.createElement('input');
                dataInput.type = 'hidden';
                dataInput.name = 'data';
                dataInput.value = JSON.stringify({ values: [Object.values(familyData)] });
                form.appendChild(dataInput);
                
                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);
                
                // Simulate success after a delay
                setTimeout(() => {
                    console.log('Family data submitted via JSONP method');
                    resolve();
                }, 2000);
            });
        }
        
        // Alternative CORS proxies for better reliability
        const CORS_PROXIES = [
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://thingproxy.freeboard.io/fetch/',
            'https://api.allorigins.win/raw?url=',
            'https://cors-anywhere.herokuapp.com/'
        ];
        
        // Google Apps Script Web App URL (most reliable solution)
        // To set this up:
        // 1. Go to https://script.google.com/
        // 2. Create a new project
        // 3. Copy the code from the comment below
        // 4. Deploy as web app with execute permissions for "Anyone"
        // 5. Replace the URL below with your deployed web app URL
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec';
        
        /*
        GOOGLE APPS SCRIPT CODE (copy this to script.google.com):
        
        function doPost(e) {
          try {
            const data = JSON.parse(e.postData.contents);
            const sheetId = '1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw';
            const sheetName = 'Family Details (Ranbankura Eagles)';
            
            const ss = SpreadsheetApp.openById(sheetId);
            const sheet = ss.getSheetByName(sheetName);
            
            if (data.action === 'addFamily') {
              // Add new family data
              const headers = [
                'WKSP', 'Ladies Name', 'Date of Birth', 'Age', 'Blood Group',
                'Religion', 'Highest Qualification', 'Languages Known', 'Can Drive', 'Owns Vehicle',
                'Personal Mobile', 'Personal Email', 'Date of Marriage', 'Years in Marriage',
                'Husband Details Husbands Name', 'Husband Rank', 'Unit', 'Sub Unit',
                'Posting Station', 'Date of Posting', 'Quarter Number', 'Colony/Enclave Name',
                'Type of Accommodation', 'Family Accommodation Address'
              ];
              
              const rowData = headers.map(header => data.data[header] || '');
              sheet.appendRow(rowData);
              
              return ContentService.createTextOutput(JSON.stringify({
                success: true,
                message: 'Family data added successfully'
              })).setMimeType(ContentService.MimeType.JSON);
            }
            
            return ContentService.createTextOutput(JSON.stringify({
              success: false,
              message: 'Invalid action'
            })).setMimeType(ContentService.MimeType.JSON);
            
          } catch (error) {
            return ContentService.createTextOutput(JSON.stringify({
              success: false,
              message: error.toString()
            })).setMimeType(ContentService.MimeType.JSON);
          }
        }
        
        function doGet(e) {
          try {
            const sheetId = '1xc4yFUKCHt3_arojTCzc8lf3fGmaco8TzTTJ-HCwpFw';
            const sheetName = 'Family Details (Ranbankura Eagles)';
            
            const ss = SpreadsheetApp.openById(sheetId);
            const sheet = ss.getSheetByName(sheetName);
            const data = sheet.getDataRange().getValues();
            
            return ContentService.createTextOutput(JSON.stringify({
              success: true,
              data: data
            })).setMimeType(ContentService.MimeType.JSON);
            
          } catch (error) {
            return ContentService.createTextOutput(JSON.stringify({
              success: false,
              message: error.toString()
            })).setMimeType(ContentService.MimeType.JSON);
          }
        }
        */
        
        // Families data from Google Sheets
        let familiesData = [];
        let filteredFamiliesData = [];
        let isLoadingFamilies = false;
        let availableWorkshops = [];

        // Initialize families count on page load
        async function initializeFamiliesCount() {
            console.log('Initializing families count...');
            try {
                // Try to fetch the count from Google Sheets
                await fetchFamiliesFromGoogleSheets();
            } catch (error) {
                console.log('Failed to fetch families count from Google Sheets, using sample data count');
                // Fallback to sample data count
                familiesData = getSampleFamiliesData();
                filteredFamiliesData = [...familiesData];
                updateFamiliesStatus('success');
            }
        }

        // Fetch families data from Google Sheets - TO BE FIXED BY JYOTI AND ADAB
        // Current implementation has issues with CORS proxy reliability and data mapping
        async function fetchFamiliesFromGoogleSheets() {
            if (isLoadingFamilies) {
                console.log('Already loading families, skipping...');
                return;
            }
            
            console.log('Starting to fetch families data...');
            isLoadingFamilies = true;
            updateFamiliesStatus('loading');
            
            try {
                // Construct the Google Sheets CSV export URL
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(GOOGLE_SHEET_NAME)}`;
                console.log('Fetching from:', sheetUrl);
                console.log('Available CORS proxies:', CORS_PROXIES);
                
                let response;
                let csvText;
                
                // Try multiple CORS proxies
                const proxies = CORS_PROXIES;
                
                let proxyIndex = 0;
                let success = false;
                
                while (proxyIndex < proxies.length && !success) {
                    try {
                        const proxyUrl = proxies[proxyIndex] + encodeURIComponent(sheetUrl);
                        console.log(`Trying proxy ${proxyIndex + 1}:`, proxyUrl);
                        
                        response = await fetch(proxyUrl, {
                            method: 'GET',
                            headers: {
                                'Accept': 'text/csv,text/plain,*/*',
                            }
                        });
                        
                        if (response.ok) {
                            csvText = await response.text();
                            console.log(`Proxy ${proxyIndex + 1} successful, got`, csvText.length, 'characters');
                            success = true;
                        } else {
                            console.log(`Proxy ${proxyIndex + 1} failed:`, response.status);
                            proxyIndex++;
                        }
                    } catch (proxyError) {
                        console.log(`Proxy ${proxyIndex + 1} error:`, proxyError.message);
                        proxyIndex++;
                    }
                }
                
                if (!success) {
                    throw new Error('All CORS proxies failed. Please check your internet connection or try again later.');
                }
                
                // Parse the CSV data
                const families = parseFamiliesCSV(csvText);
                console.log('Parsed families:', families.length);
                
                if (families.length === 0) {
                    throw new Error('No families found in the data');
                }
                
                familiesData = families;
                filteredFamiliesData = [...families]; // Initialize filtered data
                populateWorkshopFilter();
                updateFamiliesStatus('success');
                loadFamilies(); // Refresh the display
                
                // Show success message
                console.log('Successfully loaded', families.length, 'families from Google Sheets');
                
            } catch (error) {
                console.error('Error fetching families data:', error);
                updateFamiliesStatus('error');
                
                // Fallback to sample data
                familiesData = getSampleFamiliesData();
                filteredFamiliesData = [...familiesData];
                populateWorkshopFilter();
                loadFamilies();
                
                // Show error message to user
                alert(`Failed to load data from Google Sheets: ${error.message}\n\nUsing sample data instead.`);
            } finally {
                isLoadingFamilies = false;
                console.log('Finished loading families data');
            }
        }

        // Parse CSV data for families - TO BE FIXED BY JYOTI AND ADAB
        // Current implementation has issues with column mapping and data parsing
        function parseFamiliesCSV(csvText) {
            try {
                const lines = csvText.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                    console.warn('CSV has less than 2 lines');
                    return [];
                }
                
                // Parse CSV with proper handling of quoted fields
                function parseCSVLine(line) {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim());
                    return result;
                }
                
                const headers = parseCSVLine(lines[0]);
                console.log('CSV Headers:', headers);
                console.log('Total lines:', lines.length);
                console.log('Processing rows 1 to', lines.length - 1);
                
                // Log all column names that might contain husband information
                const husbandColumns = headers.filter(h => 
                    h.toLowerCase().includes('husband') || 
                    h.toLowerCase().includes('spouse')
                );
                console.log('Husband-related columns:', husbandColumns);
                console.log()
                
                // Log all headers to see the exact format
                console.log('All headers:', headers.map((h, i) => `${i}: "${h}"`));
                
                const families = [];
                let skippedCount = 0;
                let skippedReasons = {};
                let processedCount = 0;
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) {
                        console.log(`Skipping empty line at index ${i}`);
                        continue;
                    }
                    
                    const values = parseCSVLine(line);
                    
                    // Skip if we don't have enough values or if it's a header row
                    if (values.length < headers.length || values[0] === 'WKSP') {
                        skippedCount++;
                        const reason = values.length < headers.length ? 'insufficient_columns' : 'header_row';
                        skippedReasons[reason] = (skippedReasons[reason] || 0) + 1;
                        console.log(`Skipping row ${i}: ${reason}`, {
                            valuesLength: values.length,
                            headersLength: headers.length,
                            firstValue: values[0],
                            values: values.slice(0, 3)
                        });
                        continue;
                    }
                    
                    const family = {};
                    headers.forEach((header, index) => {
                        family[header.toLowerCase().replace(/\s+/g, '_')] = values[index] || '';
                    });
                    
                    // Map to our expected format using exact column names from the sheet
                    const ladyName = family.personal_information_ladies_name || '';
                    // Use the exact column name from the CSV headers
                    const husbandName = family.husband_details_husbands_name || '';
                    const mobile = family.personal_mobile || '';
                    const qualification = family.highest_qualification || '';
                    const bloodGroup = family.blood_group || '';
                    const religion = family.religion || '';
                    const marriageDate = family.date_of_marriage || '';
                    const yearsInMarriage = family.years_in_marriage || '';
                    const email = family.personal_email || '';
                    const languages = family.languages_known || '';
                    const canDrive = family.can_drive || '';
                    const ownsVehicle = family.owns_vehicle || '';
                    const husbandRank = family.husband_rank || '';
                    const unit = family.unit || '';
                    const subUnit = family.sub_unit || '';
                    const postingStation = family.posting_station || '';
                    const dateOfPosting = family.date_of_posting || '';
                    const quarterNumber = family.quarter_number || '';
                    const colonyName = family.colony_enclave_name || '';
                    const accommodationType = family.type_of_accommodation || '';
                    const accommodationAddress = family.family_accommodation_address || '';
                    
                    // Extract children data
                    const child1Name = family.child_1_name || '';
                    const child1Class = family.child_1_class || '';
                    const child2Name = family.child_2_name || '';
                    const child2Class = family.child_2_class || '';
                    const child3Name = family.child_3_name || '';
                    const child3Class = family.child_3_class || '';
                    
                    // Extract workshop information from WKSP column
                    const workshop = family.wksp || '';
                    
                    // Debug logging for husband name
                    if (ladyName && ladyName.trim()) {
                        console.log('Family:', ladyName, 'Husband data:', {
                            husbands_details_husbands_name: family.husbands_details_husbands_name,
                            husbands_name: family.husbands_name,
                            husband_name: family.husband_name,
                            husband: family.husband,
                            final: husbandName
                        });
                    }
                    
                    processedCount++;
                    
                    // Add family if we have either lady's name or husband's name
                    if ((ladyName && ladyName.trim()) || (husbandName && husbandName.trim())) {
                        const familyData = {
                            id: families.length + 1,
                            name: ladyName.trim() || husbandName.trim() || 'N/A',
                            husband: husbandName.trim() || 'N/A',
                            contact: mobile.trim() || 'N/A',
                            education: qualification.trim() || 'N/A',
                            children: yearsInMarriage.trim() || 'N/A',
                            joined: marriageDate.trim() || 'N/A',
                            workshop: workshop.trim() || 'N/A',
                            // Additional fields from the sheet
                            email: email.trim() || 'N/A',
                            bloodGroup: bloodGroup.trim() || 'N/A',
                            religion: religion.trim() || 'N/A',
                            languages: languages.trim() || 'N/A',
                            canDrive: canDrive.trim() || 'N/A',
                            ownsVehicle: ownsVehicle.trim() || 'N/A',
                            husbandRank: husbandRank.trim() || 'N/A',
                            unit: unit.trim() || 'N/A',
                            subUnit: subUnit.trim() || 'N/A',
                            postingStation: postingStation.trim() || 'N/A',
                            dateOfPosting: dateOfPosting.trim() || 'N/A',
                            quarterNumber: quarterNumber.trim() || 'N/A',
                            colonyName: colonyName.trim() || 'N/A',
                            accommodationType: accommodationType.trim() || 'N/A',
                            accommodationAddress: accommodationAddress.trim() || 'N/A',
                            // Children data
                            child1Name: child1Name.trim() || 'N/A',
                            child1Class: child1Class.trim() || 'N/A',
                            child2Name: child2Name.trim() || 'N/A',
                            child2Class: child2Class.trim() || 'N/A',
                            child3Name: child3Name.trim() || 'N/A',
                            child3Class: child3Class.trim() || 'N/A'
                        };
                        
                        families.push(familyData);
                        
                        // Collect unique workshops for filter
                        if (workshop && workshop.trim() && workshop.trim() !== 'N/A') {
                            if (!availableWorkshops.includes(workshop.trim())) {
                                availableWorkshops.push(workshop.trim());
                            }
                        }
                    } else {
                        // Log families that are skipped due to missing names
                        skippedCount++;
                        skippedReasons['missing_names'] = (skippedReasons['missing_names'] || 0) + 1;
                        console.log('Skipped family - no names:', { ladyName, husbandName, values: values.slice(0, 3) });
                    }
                }
                
                console.log(`Parsed ${families.length} families from CSV`);
                console.log(`Processed ${processedCount} rows, skipped ${skippedCount} rows:`, skippedReasons);
                console.log(`Expected 274 families, got ${families.length}, difference: ${274 - families.length}`);
                return families;
                
            } catch (error) {
                console.error('Error parsing CSV:', error);
                return [];
            }
        }

        // Sample data fallback
        function getSampleFamiliesData() {
            return Array.from({ length: 10 }, (_, i) => {
                const surnames = ['Sharma', 'Singh', 'Kumar', 'Gupta', 'Verma', 'Patel', 'Reddy', 'Joshi', 'Agarwal', 'Jain'];
                const firstNames = ['Rajesh', 'Vikram', 'Amit', 'Suresh', 'Ravi', 'Raj', 'Kiran', 'Sunil', 'Pradeep', 'Anil'];
                const educations = ['B.Tech', 'MBA', 'B.Sc', 'M.A', 'B.Com', 'M.Tech', 'B.A', 'M.Sc', 'B.E', 'M.Com'];
            const childrenCounts = ['1 Child', '2 Children', '3 Children', '1 Child', '2 Children', '1 Child', '2 Children', '3 Children', '1 Child', '2 Children'];
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
            
            // Generate children data
            const childNames = ['Arjun', 'Priya', 'Rohan', 'Kavya', 'Aryan', 'Sneha', 'Vikram', 'Ananya', 'Rahul', 'Pooja'];
            const childAges = ['5', '8', '12', '3', '15', '7', '10', '6', '9', '4'];
            
            const hasChild1 = Math.random() > 0.3; // 70% chance of having at least one child
            const hasChild2 = hasChild1 && Math.random() > 0.5; // 50% chance of second child if first exists
            const hasChild3 = hasChild2 && Math.random() > 0.7; // 30% chance of third child if second exists
            
            return {
                id: i + 1,
                name: `${surnames[i % surnames.length]} Family`,
                husband: `${firstNames[i % firstNames.length]} ${surnames[i % surnames.length]}`,
                contact: `+91-${9876500000 + i}`,
                education: educations[i % educations.length],
                children: childrenCounts[i % childrenCounts.length],
                joined: `${months[i % months.length]} 2024`,
                // Children data
                child1Name: hasChild1 ? childNames[i % childNames.length] : 'N/A',
                child1Age: hasChild1 ? childAges[i % childAges.length] : 'N/A',
                child2Name: hasChild2 ? childNames[(i + 1) % childNames.length] : 'N/A',
                child2Age: hasChild2 ? childAges[(i + 1) % childAges.length] : 'N/A',
                child3Name: hasChild3 ? childNames[(i + 2) % childNames.length] : 'N/A',
                child3Age: hasChild3 ? childAges[(i + 2) % childAges.length] : 'N/A'
            };
        });
        }

        // Update families status indicator
        function updateFamiliesStatus(status) {
            const countElement = document.querySelector('#section-families .count');
            const refreshBtn = document.getElementById('refreshFamiliesBtn');
            
            if (countElement) {
                switch (status) {
                    case 'loading':
                        countElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                        break;
                    case 'success':
                        countElement.textContent = `(${familiesData.length})`;
                        break;
                    case 'error':
                        countElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                        break;
                    default:
                        countElement.textContent = `(${familiesData.length})`;
                }
            }
            
            if (refreshBtn) {
                const icon = refreshBtn.querySelector('i');
                const text = refreshBtn.querySelector('span') || refreshBtn.childNodes[refreshBtn.childNodes.length - 1];
                
                switch (status) {
                    case 'loading':
                        icon.className = 'fas fa-spinner fa-spin';
                        refreshBtn.disabled = true;
                        refreshBtn.style.opacity = '0.6';
                        refreshBtn.title = 'Loading data...';
                        break;
                    case 'success':
                        icon.className = 'fas fa-sync-alt';
                        refreshBtn.disabled = false;
                        refreshBtn.style.opacity = '1';
                        refreshBtn.title = 'Refresh data from Google Sheets';
                        break;
                    case 'error':
                        icon.className = 'fas fa-sync-alt';
                        refreshBtn.disabled = false;
                        refreshBtn.style.opacity = '1';
                        refreshBtn.title = 'Retry loading data';
                        break;
                }
            }
        }

        // Sample companies data (matching old dashboard style)
        const companiesData = [
            { id: "Coy001", femaleName: "Priya Sharma", spouseName: "Rajesh Sharma", education: "B.Tech", phoneNumber: "+91-9000000001", rank: "Col" },
            { id: "Coy002", femaleName: "Kavita Singh", spouseName: "Vikram Singh", education: "MBA", phoneNumber: "+91-9000000002", rank: "Lt Col" },
            { id: "Coy003", femaleName: "Sunita Verma", spouseName: "Amit Verma", education: "B.Sc", phoneNumber: "+91-9000000003", rank: "Maj" },
            { id: "Coy004", femaleName: "Rekha Patel", spouseName: "Ravi Patel", education: "M.A", phoneNumber: "+91-9000000004", rank: "Capt" },
            { id: "Coy005", femaleName: "Meera Gupta", spouseName: "Suresh Gupta", education: "B.Com", phoneNumber: "+91-9000000005", rank: "Lt" },
            { id: "Coy006", femaleName: "Anita Kumar", spouseName: "Raj Kumar", education: "M.Tech", phoneNumber: "+91-9000000006", rank: "Sqn Ldr" },
            { id: "Coy007", femaleName: "Sushila Yadav", spouseName: "Vijay Yadav", education: "B.A", phoneNumber: "+91-9000000007", rank: "Flt Lt" },
            { id: "Coy008", femaleName: "Geeta Tiwari", spouseName: "Ramesh Tiwari", education: "M.Sc", phoneNumber: "+91-9000000008", rank: "Fg Offr" }
        ];

        // Populate workshop filter buttons
        function populateWorkshopFilter() {
            const workshopButtons = document.getElementById('workshopButtons');
            if (!workshopButtons) return;
            
            // Clear existing buttons except "All Workshops"
            workshopButtons.innerHTML = '<button class="workshop-btn active" data-workshop="" onclick="filterByWorkshop(\'\')">All Workshops</button>';
            
            // Sort workshops alphabetically
            const sortedWorkshops = availableWorkshops.sort();
            
            // Add workshop buttons
            sortedWorkshops.forEach(workshop => {
                if (workshop && workshop.trim() !== '') {
                    const button = document.createElement('button');
                    button.className = 'workshop-btn';
                    button.setAttribute('data-workshop', workshop);
                    button.textContent = workshop;
                    button.onclick = () => filterByWorkshop(workshop);
                    workshopButtons.appendChild(button);
                }
            });
            
            console.log('Available Workshops:', sortedWorkshops);
        }

        // Filter families by workshop
        function filterByWorkshop(workshop) {
            // Remove active class from all buttons
            document.querySelectorAll('.workshop-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Apply the filter
            filterFamilies();
        }
        
        // Filter families based on search and workshop
        function filterFamilies() {
            const searchTerm = document.getElementById('familySearchInput')?.value.toLowerCase() || '';
            const activeWorkshopBtn = document.querySelector('.workshop-btn.active');
            const workshopFilter = activeWorkshopBtn ? activeWorkshopBtn.getAttribute('data-workshop') : '';
            
            filteredFamiliesData = familiesData.filter(family => {
                const matchesSearch = !searchTerm || 
                    family.name.toLowerCase().includes(searchTerm) ||
                    family.husband.toLowerCase().includes(searchTerm) ||
                    family.contact.toLowerCase().includes(searchTerm) ||
                    family.education.toLowerCase().includes(searchTerm);
                
                const matchesWKSP = !workshopFilter || 
                    family.workshop === workshopFilter;
                
                return matchesSearch && matchesWKSP;
            });
            
            loadFamilies();
            updateFamiliesCount();
        }

        // Update families count display
        function updateFamiliesCount() {
            const countElement = document.querySelector('#section-families .count');
            if (countElement) {
                countElement.textContent = `(${filteredFamiliesData.length})`;
            }
        }

        // ===========================================
        // FAMILY FORM MANAGEMENT FUNCTIONS
        // ===========================================
        
        // Open Add Family Modal
        function toggleAddFamilyForm() {
            // Check if user has permission to add families (Super Users only)
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
            const isSuperUser = userInfo.userType === 'L1' || userInfo.userType === 'admin';
            
            if (!isSuperUser) {
                alert('Only Super Users can add family data. Please contact your administrator.');
                return;
            }
            
            const modal = document.getElementById('addFamilyModal');
            console.log('Modal element:', modal); // Debug log
            
            if (modal) {
                console.log('Opening modal...'); // Debug log
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                console.log('Modal classes after opening:', modal.className); // Debug log
                console.log('Modal computed style display:', window.getComputedStyle(modal).display); // Debug log
            } else {
                console.error('Modal element not found!');
            }
        }
        
        // Close Add Family Modal
        function closeAddFamilyModal() {
            const modal = document.getElementById('addFamilyModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
                resetAddFamilyForm();
                console.log('Modal closed'); // Debug log
            }
        }
        
        // Reset Add Family Form
        function resetAddFamilyForm() {
            const form = document.getElementById('addFamilyForm');
            if (form) {
                form.reset();
            }
        }
        
        // Handle Add Family Form Submission
        function handleAddFamilyForm(event) {
            event.preventDefault();
            
            // Get form data
            const formData = new FormData(event.target);
            const familyData = {};
            
            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                familyData[key] = value;
            }
            
            // Validate required fields
            if (!familyData.wksp || !familyData.ladiesName || !familyData.mobile) {
                alert('Please fill in all required fields (WKSP, Ladies Name, and Personal Mobile)');
                return;
            }
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            submitBtn.disabled = true;
            
            // Add family to Google Sheets
            addFamilyToGoogleSheets(familyData)
                .then(() => {
                    alert('Family added successfully to Google Sheets!');
                    resetAddFamilyForm();
                    closeAddFamilyModal();
                    // Refresh families data
                    fetchFamiliesFromGoogleSheets();
                })
                .catch((error) => {
                    console.error('Error adding family:', error);
                    if (error.message.includes('API key not configured')) {
                        alert('Google Sheets API not configured. Family data has been saved locally. Please contact the administrator to configure the API.');
                    } else {
                        const errorMessage = handleCORSError(error, 'adding family to Google Sheets');
                        alert('Error adding family: ' + errorMessage);
                    }
                })
                .finally(() => {
                    // Reset button state         
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        }
        
        // Check Add Family Permissions
        function checkAddFamilyPermissions() {
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
            const isSuperUser = userInfo.userType === 'L1' || userInfo.userType === 'admin';
            const addFamilyBtn = document.getElementById('addFamilyBtn');
            
            if (addFamilyBtn) {
                if (isSuperUser) {
                    // Show Add Family button for super users
                    addFamilyBtn.style.display = 'flex';
                } else {
                    // Hide Add Family button for non-super users
                    addFamilyBtn.style.display = 'none';
                }
            }
        }

        // Check if Google Sheets API is properly configured
        function isGoogleSheetsConfigured() {
            return GOOGLE_API_KEY && GOOGLE_API_KEY !== 'YOUR_GOOGLE_SHEETS_API_KEY_HERE';
        }

        // Display pending families from localStorage
        function displayPendingFamilies() {
            const pendingFamilies = JSON.parse(localStorage.getItem('pendingFamilies') || '[]');
            if (pendingFamilies.length > 0) {
                console.log('Pending families in localStorage:', pendingFamilies);
                // You can add UI to display these pending families
                // For now, we'll just log them
            }
        }

        // Handle CORS issues with better error messages
        function handleCORSError(error, context = 'API call') {
            console.error(`CORS Error in ${context}:`, error);
            
            if (error.message.includes('CORS')) {
                return 'CORS policy blocked the request. This is a browser security feature. Please try using a different browser or contact the administrator.';
            } else if (error.message.includes('NetworkError')) {
                return 'Network error occurred. Please check your internet connection and try again.';
            } else if (error.message.includes('Failed to fetch')) {
                return 'Failed to connect to the server. Please check your internet connection and try again.';
            } else {
                return `Error: ${error.message}`;
            }
        }

        // Add Family to Google Sheets
        async function addFamilyToGoogleSheets(familyData) {
            try {
                console.log('Adding family to Google Sheets:', familyData);
                console.log('API Key configured:', isGoogleSheetsConfigured());
                console.log('API Key value:', GOOGLE_API_KEY);
                
                // Check if API key is configured
                if (!isGoogleSheetsConfigured()) {
                    throw new Error('Google Sheets API key not configured. Please contact administrator.');
                }
                
                // Map form data to Google Sheets column structure (matching actual Excel sheet)
                const mappedData = {
                    'WKSP': familyData.wksp || '',
                    'Ladies Name': familyData.ladiesName || '',
                    'Date of Birth': familyData.dateOfBirth || '',
                    'Age': familyData.age || '',
                    'Blood Group': familyData.bloodGroup || '',
                    'Religion': familyData.religion || '',
                    'Highest Qualification': familyData.qualification || '',
                    'Languages Known': familyData.languages || '',
                    'Can Drive': familyData.canDrive || '',
                    'Owns Vehicle': familyData.ownsVehicle || '',
                    'Personal Mobile': familyData.mobile || '',
                    'Personal Email': familyData.email || '',
                    'Date of Marriage': familyData.dateOfMarriage || '',
                    'Years in Marriage': familyData.yearsInMarriage || '',
                    'Husband Details Husbands Name': familyData.husbandName || '',
                    'Husband Rank': familyData.husbandRank || '',
                    'Unit': familyData.unit || '',
                    'Sub Unit': familyData.subUnit || '',
                    'Posting Station': familyData.postingStation || '',
                    'Date of Posting': familyData.dateOfPosting || '',
                    'Quarter Number': familyData.quarterNumber || '',
                    'Colony/Enclave Name': familyData.colonyName || '',
                    'Type of Accommodation': familyData.accommodationType || '',
                    'Family Accommodation Address': familyData.accommodationAddress || ''
                };
                
                // Get the headers from the existing data to maintain column order
                const headers = [
                    'WKSP', 'Ladies Name', 'Date of Birth', 'Age', 'Blood Group',
                    'Religion', 'Highest Qualification', 'Languages Known', 'Can Drive', 'Owns Vehicle',
                    'Personal Mobile', 'Personal Email', 'Date of Marriage', 'Years in Marriage',
                    'Husband Details Husbands Name', 'Husband Rank', 'Unit', 'Sub Unit',
                    'Posting Station', 'Date of Posting', 'Quarter Number', 'Colony/Enclave Name',
                    'Type of Accommodation', 'Family Accommodation Address'
                ];
                
                // Create the row data in the correct order
                const rowData = headers.map(header => mappedData[header] || '');
                
                // Method 1: Try Google Apps Script (most reliable)
                if (GOOGLE_APPS_SCRIPT_URL && GOOGLE_APPS_SCRIPT_URL !== 'https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec') {
                    try {
                        console.log('Trying Google Apps Script method...');
                        
                        const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                action: 'addFamily',
                                data: mappedData
                            })
                        });
                        
                        console.log('Family data submitted via Google Apps Script');
                        
                        // Refresh the families data to show the new entry
                        await fetchFamiliesFromGoogleSheets();
                        
                        return Promise.resolve();
                    } catch (scriptError) {
                        console.log('Google Apps Script method failed, trying CORS proxies...', scriptError);
                    }
                } else {
                    console.log('Google Apps Script not configured, trying CORS proxies...');
                }
                
                // Method 2: Try multiple CORS proxies (fallback)
                let proxyIndex = 0;
                let success = false;
                
                while (proxyIndex < CORS_PROXIES.length && !success) {
                    try {
                        const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/${encodeURIComponent(GOOGLE_SHEET_NAME)}:append?valueInputOption=USER_ENTERED&key=${GOOGLE_API_KEY}`;
                        const proxyUrl = CORS_PROXIES[proxyIndex] + encodeURIComponent(apiUrl);
                        
                        console.log(`Trying CORS proxy ${proxyIndex + 1}:`, CORS_PROXIES[proxyIndex]);
                        
                        const response = await fetch(proxyUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: [rowData]
                            })
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log(`Family data successfully added via proxy ${proxyIndex + 1}:`, result);
                            
                            // Refresh the families data to show the new entry
                            await fetchFamiliesFromGoogleSheets();
                            
                            success = true;
                            return result;
                        } else {
                            console.log(`Proxy ${proxyIndex + 1} failed:`, response.status, response.statusText);
                            proxyIndex++;
                        }
                    } catch (proxyError) {
                        console.log(`Proxy ${proxyIndex + 1} error:`, proxyError.message);
                        proxyIndex++;
                    }
                }
                
                if (!success) {
                    console.log('All methods failed, using fallback...');
                    throw new Error('All API methods failed. Please set up Google Apps Script or use a local server.');
                }
                
            } catch (error) {
                console.error('Error adding family to Google Sheets:', error);
                
                // Fallback: Store in localStorage and show instructions
                try {
                    const pendingFamilies = JSON.parse(localStorage.getItem('pendingFamilies') || '[]');
                    pendingFamilies.push({
                        ...familyData,
                        timestamp: new Date().toISOString(),
                        id: Date.now()
                    });
                    localStorage.setItem('pendingFamilies', JSON.stringify(pendingFamilies));
                    
                    // Show instructions to user
                    alert(`Family data saved locally due to CORS error. To fix this:\n\n1. Run a local server:\n   python -m http.server 8000\n\n2. Open: http://localhost:8000/dashboard_super user.html\n\n3. Try adding the family again\n\nFamily: ${familyData.ladiesName}\nWKSP: ${familyData.wksp}\nMobile: ${familyData.mobile}\n\nError: ${error.message}`);
                    
                    console.log('Family data stored locally as fallback');
                    return Promise.resolve();
                } catch (fallbackError) {
                    console.error('Fallback method also failed:', fallbackError);
                    throw new Error(`Failed to add family data: ${error.message}`);
                }
            }
        }

        // ===========================================
        // FAMILY DETAIL MODAL FUNCTIONS
        // ===========================================
        
        // Open Family Detail Modal
        function openFamilyDetailModal(familyData) {
            console.log('Opening family detail modal for:', familyData);
            const modal = document.getElementById('familyDetailModal');
            if (modal) {
                populateFamilyDetailContent(familyData);
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }
        
        // Close Family Detail Modal
        function closeFamilyDetailModal() {
            const modal = document.getElementById('familyDetailModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }
        
        // DISABLED - About section functions
        /*
        // Open Brochure Modal
        function openBrochureModal() {
            const modal = document.getElementById('brochureModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }
        
        // Close Brochure Modal
        function closeBrochureModal() {
            const modal = document.getElementById('brochureModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }
        */
        
        // Helper function to check if a value should be displayed
        function shouldDisplayValue(value) {
            if (!value || value === 'N/A' || value === 'NA' || value === 'undefined' || value === 'null' || value === '' || value === '-') {
                return false;
            }
            return true;
        }

        // Helper function to create detail row only if value should be displayed
        function createDetailRow(label, value, icon = '') {
            if (!shouldDisplayValue(value)) {
                return '';
            }
            return `
                <div class="detail-row">
                    <span class="detail-label">${label}</span>
                    <span class="detail-value">${value}</span>
                </div>
            `;
        }

        // Populate Family Detail Content
        function populateFamilyDetailContent(family) {
            console.log("Family DATA:",family);
            const content = document.getElementById('familyDetailContent');
            if (!content) return;
            
            // Create the detailed family information HTML
            content.innerHTML = `
                <div class="family-detail-section">
                    <h4><i class="fas fa-user"></i> Personal Information</h4>
                    <div class="family-photo">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    ${createDetailRow('Name', family.name)}
                    ${createDetailRow('WKSP', family.workshop)}
                    ${createDetailRow('Date of Birth', family.joined)}
                    ${createDetailRow('Blood Group', family.bloodGroup)}
                    ${createDetailRow('Religion', family.religion)}
                    ${createDetailRow('Education', family.education)}
                    ${createDetailRow('Languages', family.languages)}
                    ${createDetailRow('Can Drive', family.canDrive)}
                    ${createDetailRow('Owns Vehicle', family.ownsVehicle)}
                </div>
                
                <div class="family-detail-section">
                    <h4><i class="fas fa-heart"></i> Family Details</h4>
                    ${createDetailRow('Husband Name', family.husband)}
                    ${createDetailRow('Husband Rank', family.husbandRank)}
                    ${createDetailRow('Unit', family.unit)}
                    ${createDetailRow('Sub Unit', family.subUnit)}
                    ${createDetailRow('Posting Station', family.postingStation)}
                    ${createDetailRow('Date of Posting', family.dateOfPosting)}
                    ${createDetailRow('Date of Joining', family.joined)}
                    ${createDetailRow('Years in Marriage', family.children)}
                </div>
                
                <div class="family-detail-section">
                    <h4><i class="fas fa-home"></i> Accommodation</h4>
                    ${createDetailRow('Quarter Number', family.quarterNumber)}
                    ${createDetailRow('Colony Name', family.colonyName)}
                    ${createDetailRow('Accommodation Type', family.accommodationType)}
                    ${createDetailRow('Address', family.accommodationAddress)}
                </div>
                
                <div class="family-detail-section">
                    <h4><i class="fas fa-child"></i> Children Information</h4>
                    <div class="children-info">
                        ${(() => {
                            let childrenHtml = '';
                            if (family.child1Name && family.child1Name !== 'N/A' && family.child1Name.trim()) {
                                childrenHtml += `
                                    <div class="child-item">
                                        <div class="child-name">${family.child1Name}</div>
                                        <div class="child-age">Class: ${family.child1Class !== 'N/A' ? family.child1Class : 'Not specified'}</div>
                                    </div>
                                `;
                            }
                            if (family.child2Name && family.child2Name !== 'N/A' && family.child2Name.trim()) {
                                childrenHtml += `
                                    <div class="child-item">
                                        <div class="child-name">${family.child2Name}</div>
                                        <div class="child-age">Class: ${family.child2Class !== 'N/A' ? family.child2Child : 'Not specified'}</div>
                                    </div>
                                `;
                            }
                            if (family.child3Name && family.child3Name !== 'N/A' && family.child3Name.trim()) {
                                childrenHtml += `
                                    <div class="child-item">
                                        <div class="child-name">${family.child3Name}</div>
                                        <div class="child-age">Class:${family.child3Child !== 'N/A' ? family.child3Child : 'Not specified'}</div>
                                    </div>
                                `;
                            }
                            if (!childrenHtml) {
                                childrenHtml = '<div class="no-children">No children information available</div>';
                            }
                            return childrenHtml;
                        })()}
                    </div>
                </div>
                
                <div class="family-detail-section">
                    <h4><i class="fas fa-phone"></i> Contact Information</h4>
                    <div class="contact-info">
                        ${shouldDisplayValue(family.contact) ? `
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>${family.contact}</span>
                            </div>
                        ` : ''}
                        ${shouldDisplayValue(family.email) ? `
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span>${family.email}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="family-detail-section">
                    <h4><i class="fas fa-chart-bar"></i> Family Statistics</h4>
                    <div class="family-stats">
                        ${shouldDisplayValue(family.workshop) ? `
                            <div class="stat-card">
                                <div class="stat-number">${family.workshop}</div>
                                <div class="stat-label">Workshop</div>
                            </div>
                        ` : ''}
                        ${shouldDisplayValue(family.education) ? `
                            <div class="stat-card">
                                <div class="stat-number">${family.education}</div>
                                <div class="stat-label">Education Level</div>
                            </div>
                        ` : ''}
                        ${shouldDisplayValue(family.canDrive) ? `
                            <div class="stat-card">
                                <div class="stat-number">${family.canDrive}</div>
                                <div class="stat-label">Can Drive</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Add event listeners for family detail modal and brochure modal
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            document.addEventListener('click', function(event) {
                const familyModal = document.getElementById('familyDetailModal');
                const brochureModal = document.getElementById('brochureModal');
                
                if (familyModal && !familyModal.classList.contains('hidden')) {
                    if (event.target === familyModal) {
                        closeFamilyDetailModal();
                    }
                }
                
                // DISABLED - About section modal
                /*
                if (brochureModal && !brochureModal.classList.contains('hidden')) {
                    if (event.target === brochureModal) {
                        closeBrochureModal();
                    }
                }
                */
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeFamilyDetailModal();
                    // closeBrochureModal(); // DISABLED - About section
                }
            });
        });

        // Load families data from Google Sheets
        function loadFamilies() {
            const familiesGrid = document.getElementById('familiesGrid');
            if (!familiesGrid) return;

            if (filteredFamiliesData.length === 0) {
                familiesGrid.innerHTML = `
                    <div class="no-data-message">
                        <i class="fas fa-info-circle"></i>
                        <p>No families found matching your filters. Try adjusting your search or WKSP filter.</p>
                    </div>
                `;
                return;
            }

            familiesGrid.innerHTML = filteredFamiliesData.map(f => `
                <div class="family-card" onclick="openFamilyDetailModal(${JSON.stringify(f).replace(/"/g, '&quot;')})" style="cursor: pointer;">
                    <div class="fc-top">
                        <h4>${f.name}</h4>
                        <span class="badge success">AWWA REGISTERED</span>
                    </div>
                    <div class="fc-body">
                        <div class="row"><span class="label">Husband Name:</span><span class="val">${f.husband}</span></div>
                        <div class="row"><span class="label">Contact:</span><span class="val">${f.contact}</span></div>
                        <div class="row"><span class="label">Education:</span><span class="val">${f.education}</span></div>
                        <div class="row"><span class="label">WKSP:</span><span class="val">${f.workshop}</span></div>
                    </div>
                </div>
            `).join('');
        }

        // Load WKSP data
        // Global variables for FW Coy functionality
        let currentFilter = 'all';
        let currentSort = 'count-desc';
        let fwCoyData = [];

        function loadWorkshops() {
            const workshopGrid = document.getElementById('workshopGrid');
            const workshopCount = document.getElementById('workshopCount');
            if (!workshopGrid) return;
            
            // Get WKSP data from families data
            fwCoyData = getWKSPStatistics();
            
            if (fwCoyData.length === 0) {
                workshopGrid.innerHTML = '<div class="no-data">No FW Coy data available</div>';
                if (workshopCount) workshopCount.textContent = '(0)';
                updateAnalyticsSummary([]);
                return;
            }
            
            // Update analytics summary
            updateAnalyticsSummary(fwCoyData);
            
            // Apply filters and sorting
            const filteredData = applyFiltersAndSort(fwCoyData);
            
            // Update count
            if (workshopCount) {
                workshopCount.textContent = `(${filteredData.length})`;
            }
            
            // Render cards
            renderWorkshopCards(filteredData, workshopGrid);
        }


        // Update analytics summary
        function updateAnalyticsSummary(data) {
            const totalUnits = document.getElementById('totalUnits');
            const totalFamilies = document.getElementById('totalFamilies');
            const avgFamiliesPerUnit = document.getElementById('avgFamiliesPerUnit');
            const largestUnit = document.getElementById('largestUnit');
            
            if (data.length === 0) {
                if (totalUnits) totalUnits.textContent = '0';
                if (totalFamilies) totalFamilies.textContent = '0';
                if (avgFamiliesPerUnit) avgFamiliesPerUnit.textContent = '0';
                if (largestUnit) largestUnit.textContent = '-';
                return;
            }
            
            const totalFamiliesCount = data.reduce((sum, unit) => sum + unit.count, 0);
            const avgFamilies = Math.round(totalFamiliesCount / data.length);
            const largest = data.reduce((max, unit) => unit.count > max.count ? unit : max, data[0]);
            
            if (totalUnits) totalUnits.textContent = data.length;
            if (totalFamilies) totalFamilies.textContent = totalFamiliesCount;
            if (avgFamiliesPerUnit) avgFamiliesPerUnit.textContent = avgFamilies;
            if (largestUnit) largestUnit.textContent = largest.name;
        }

        // Apply filters and sorting
        function applyFiltersAndSort(data) {
            let filtered = [...data];
            
            // Apply type filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(unit => unit.name.includes(currentFilter));
            }
            
            // Apply sorting
            switch (currentSort) {
                case 'count-desc':
                    filtered.sort((a, b) => b.count - a.count);
                    break;
                case 'count-asc':
                    filtered.sort((a, b) => a.count - b.count);
                    break;
                case 'name-asc':
                    filtered.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    filtered.sort((a, b) => b.name.localeCompare(a.name));
                    break;
            }
            
            return filtered;
        }

        // Render workshop cards
        function renderWorkshopCards(data, container) {
            container.innerHTML = data.map(wksp => {
                const unitType = getUnitType(wksp.name);
                const iconClass = getUnitIcon(unitType);
                
                return `
                    <div class="workshop-card ${unitType.toLowerCase()}" onclick="openUnitDetailModal('${wksp.name}', ${wksp.count})">
                        <div class="workshop-header">
                            <div class="workshop-icon">
                                <i class="${iconClass}"></i>
                    </div>
                            <div class="workshop-info">
                                <h3>${wksp.name}</h3>
                                <p>624 Sub Unit - ${unitType}</p>
                    </div>
                </div>
                        <div class="workshop-stats">
                            <div class="workshop-count">${wksp.count}</div>
                            <div class="workshop-label">Families</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get unit type from name
        function getUnitType(name) {
            if (name.includes('BHQ')) return 'BHQ';
            if (name.includes('AW')) return 'AW';
            if (name.includes('FWC')) return 'FWC';
            return 'FWC';
        }

        // Get unit icon
        function getUnitIcon(type) {
            switch (type) {
                case 'FWC': return 'fas fa-building';
                case 'AW': return 'fas fa-building';
                case 'BHQ': return 'fas fa-flag';
                default: return 'fas fa-building';
            }
        }


        // Open unit detail modal
        function openUnitDetailModal(unitName, familyCount) {
            const modal = document.getElementById('unitDetailModal');
            const title = document.getElementById('unitDetailTitle');
            const body = document.getElementById('unitDetailBody');
            
            if (!modal || !title || !body) return;
            
            title.textContent = `${unitName} Details`;
            
            // Generate sample detailed data
            const unitType = getUnitType(unitName);
            const avgAge = Math.floor(Math.random() * 20) + 25;
            const educationLevel = Math.floor(Math.random() * 3) + 1;
            const medicalStatus = Math.random() > 0.5 ? 'Good' : 'Regular';
            
            body.innerHTML = `
                <div class="unit-detail-card">
                    <h4>Total Families</h4>
                    <div class="value">${familyCount}</div>
                </div>
                <div class="unit-detail-card">
                    <h4>Unit Type</h4>
                    <div class="value">${unitType}</div>
                </div>
                <div class="unit-detail-card">
                    <h4>Avg Family Size</h4>
                    <div class="value">${Math.floor(Math.random() * 3) + 3}</div>
                </div>
                <div class="unit-detail-card">
                    <h4>Education Level</h4>
                    <div class="value">${educationLevel}/5</div>
                </div>
                <div class="unit-detail-card">
                    <h4>Medical Status</h4>
                    <div class="value">${medicalStatus}</div>
                </div>
                <div class="unit-detail-card">
                    <h4>Last Updated</h4>
                    <div class="value">${new Date().toLocaleDateString()}</div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        // Close unit detail modal
        function closeUnitDetailModal() {
            const modal = document.getElementById('unitDetailModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Get WKSP statistics from families data - Google Sheets only
        function getWKSPStatistics() {
            // Only use Google Sheets data, no sample data fallback
            if (!familiesData || familiesData.length === 0) {
                console.log('No families data available for FW Coy');
                return [];
            }
            
            const wkspCounts = {};
            let validWkspCount = 0;
            
            familiesData.forEach(family => {
                // Try multiple possible field names for WKSP
                const wksp = family.wksp || family.workshop || family.WKSP || family.unit || family['WKSP'] || 'Unknown WKSP';
                
                if (wksp !== 'Unknown WKSP') {
                    validWkspCount++;
                }
                
                wkspCounts[wksp] = (wkspCounts[wksp] || 0) + 1;
            });
            
            // Only return data if we have valid WKSP data from Google Sheets
            if (validWkspCount > 0) {
                const result = Object.entries(wkspCounts)
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count); // Sort by count descending
                    
                console.log('FW Coy data loaded from Google Sheets:', result);
                return result;
            } else {
                console.log('No valid WKSP data found in Google Sheets');
                return [];
            }
        }
        

        // Initialize FW Coy event listeners
        function initFwCoyEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    // Update current filter
                    currentFilter = this.getAttribute('data-filter');
                    // Reload data
                    loadWorkshops();
                });
            });

            // Sort select
            const sortSelect = document.getElementById('fwCoySortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    currentSort = this.value;
                    loadWorkshops();
                });
            }


            // Modal close on outside click
            const modal = document.getElementById('unitDetailModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeUnitDetailModal();
                    }
                });
            }

            // Modal close on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeUnitDetailModal();
                }
            });
        }

        // Microphone permission handler for D-ID
        function requestMicrophonePermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        console.log('Microphone access granted');
                        // Stop the stream as we just needed permission
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(function(error) {
                        console.error('Microphone access denied:', error);
                        console.log('Microphone access denied - Badi Didi will work without voice features');
                    });
            } else {
                console.error('getUserMedia not supported');
                console.log('Microphone not supported - Badi Didi will work without voice features');
            }
        }

        // Check if we're on HTTPS
        function checkHTTPS() {
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                console.warn('D-ID requires HTTPS for microphone access');
                console.log('HTTPS recommended for full Badi Didi functionality');
            }
        }


        // Initialize navigation
document.addEventListener('DOMContentLoaded', function() {
            // Check HTTPS and request microphone permission
            checkHTTPS();
            setTimeout(requestMicrophonePermission, 2000); // Delay to let D-ID load first
            
            // Add click listeners to navigation
            document.querySelectorAll('.lp-nav li').forEach(li => {
                li.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    switchSection(target);
                    
                    // Load data based on section
                    if (target === 'section-families') {
                        // Fetch fresh data from Google Sheets when families section is opened
                        if (familiesData.length === 0) {
                            fetchFamiliesFromGoogleSheets();
                        } else {
                        loadFamilies();
                        }
                    } else if (target === 'section-companies') {
                        // Always fetch fresh data from Google Sheets for FW Coy section
                        console.log('Loading FW Coy section - fetching fresh data from Google Sheets');
                            fetchFamiliesFromGoogleSheets().then(() => {
                                loadWorkshops();
                                setTimeout(initFwCoyEventListeners, 100);
                        }).catch((error) => {
                            console.error('Error loading FW Coy data:', error);
                            loadWorkshops(); // Still try to load with whatever data we have
                            setTimeout(initFwCoyEventListeners, 100);
                        });
                    }
                    
                    // Initialize charts when dashboard is shown
                    if (target === 'section-dashboard') {
                        initChartsOnce();
                        setTimeout(initChartsOnce, 500);
                    }
                    
                    // Close navigation on mobile after clicking
                    if (window.innerWidth <= 768) {
                        const lpNav = document.getElementById('lpNav');
                        const navToggle = document.getElementById('navToggle');
                        const icon = navToggle.querySelector('i');
                        const text = navToggle.querySelector('span');
                        
                        lpNav.classList.remove('expanded');
                        lpNav.classList.add('collapsed');
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                        text.textContent = 'Menu';
                        navToggle.classList.remove('active');
                    }
                });
            });
            
            // Add event listeners for family filtering
            const familySearchInput = document.getElementById('familySearchInput');
            const workshopFilter = document.getElementById('workshopFilter');
            
            if (familySearchInput) {
                familySearchInput.addEventListener('input', filterFamilies);
            }
            
            // Initialize charts immediately and with delay
            initChartsOnce();
            setTimeout(initChartsOnce, 1000);
            
            // Add form event listener for Add Family form
            const addFamilyForm = document.getElementById('addFamilyForm');
            if (addFamilyForm) {
                addFamilyForm.addEventListener('submit', handleAddFamilyForm);
            }
            
            // Check user permissions for Add Family button
            checkAddFamilyPermissions();
            
            // Add modal close functionality
            const modal = document.getElementById('addFamilyModal');
            if (modal) {
                // Close modal when clicking outside
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeAddFamilyModal();
                    }
                });
                
                // Close modal with Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                        closeAddFamilyModal();
                    }
                });
            }
        });

        
        function loadUserInfo() {
            // ===========================================
            // DEFAULT USER DATA (FALLBACK)
            // ===========================================
            // This serves as a fallback if no user data is found in localStorage.
            // Used for demonstration purposes or when accessing dashboard directly.
            
            const defaultUserInfo = {
                userId: 'tarunpreet singh',
                name: 'Col Tarunpreet Singh',
                designation: 'Commanding Officer',
                phone: '9650300475',
                userType: 'L1 (Super User)',
                hasSpouse: true,  // Default user has spouse information
                spouse: {
                    name: 'Mrs. Deepkiran Kaur',
                    email: 'deepkirankaur23@gmail.com',
                    phone: '7052615743',
                    relationship: 'Spouse'
                }
            };
            
            // ===========================================
            // LOAD USER DATA FROM SESSION STORAGE
            // ===========================================
            // Retrieve user information from localStorage (set during login).
            // If no data found, use default user information.
            
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || JSON.stringify(defaultUserInfo));
            
            // ===========================================
            // UPDATE USER INFORMATION PANEL
            // ===========================================
            // Display user-specific information in the main user info card.
            // This includes personal details like name, designation, contact, etc.
            
            const userInfoBody = document.getElementById('userInfoBody');
            if (userInfoBody) {
                // Build HTML for user information display
                let userInfoHTML = `
                    <div class="info-row"><span class="label">User ID:</span><span class="value">${userInfo.userId}</span></div>
                    <div class="info-row"><span class="label">Name:</span><span class="value">${userInfo.name}</span></div>
                    <div class="info-row"><span class="label">Designation:</span><span class="value">${userInfo.designation || 'N/A'}</span></div>
                    <div class="info-row"><span class="label">Contact Number:</span><span class="value">${userInfo.phone || 'N/A'}</span></div>
                    <div class="info-row"><span class="label">User Type:</span><span class="value">${userInfo.userType || 'admin'}</span></div>
                `;
                
                // Insert the HTML into the user information panel
                userInfoBody.innerHTML = userInfoHTML;
            }
            
            // ===========================================
            // APPLY CONSISTENT STYLING TO USER INFO CARD
            // ===========================================
            // Apply the orange theme styling to the user information card for all users.
            // This creates a consistent visual experience across different user types.
            
            const userInfoPanel = userInfoBody.closest('.panel-card');
            if (userInfoPanel) {
                // Apply the data attribute that triggers orange theme CSS styling
                userInfoPanel.setAttribute('data-wife-details', 'true');
            }
            
            // ===========================================
            // SPOUSE INFORMATION DISPLAY LOGIC
            // ===========================================
            // This section handles the conditional display of spouse information.
            // Only users with spouse data (like Col Tarunpreet Singh) will see spouse details.
            // Other users will see a generic "Additional Details" section.
            
            const additionalDetailsTitle = document.getElementById('additionalDetailsTitle');
            const additionalDetailsBody = document.getElementById('additionalDetailsBody');
            
            // ===========================================
            // CHECK FOR SPOUSE INFORMATION
            // ===========================================
            // Only display spouse information if user has spouse data
            // Currently only Col Tarunpreet Singh has spouse information
            
            if (userInfo.hasSpouse && userInfo.spouse) {
                // ===========================================
                // SPOUSE PROFILE DISPLAY
                // ===========================================
                // User has spouse information - display spouse profile
                
                // Update section title to indicate spouse information
                additionalDetailsTitle.textContent = 'Spouse Profile';
                
                // Add spouse image to the header for visual appeal
                const additionalDetailsImage = document.getElementById('additionalDetailsImage');
                const wifeImage = document.getElementById('wifeImage');
                if (additionalDetailsImage && wifeImage) {
                    wifeImage.src = 'public/Gemini_Generated_Image_rwk0q2rwk0q2rwk0.png';
                    additionalDetailsImage.style.display = 'block';
                }
                
                // Apply orange theme styling to match user info card
                const additionalDetailsPanel = additionalDetailsTitle.closest('.panel-card');
                if (additionalDetailsPanel) {
                    additionalDetailsPanel.setAttribute('data-wife-details', 'true');
                }
                
                // Display spouse information dynamically from user data
                additionalDetailsBody.innerHTML = `
                    <div class="info-row"><span class="label">Name:</span><span class="value">${userInfo.spouse.name}</span></div>
                    <div class="info-row"><span class="label">Email:</span><span class="value">${userInfo.spouse.email}</span></div>
                    <div class="info-row"><span class="label">Contact:</span><span class="value">${userInfo.spouse.phone}</span></div>
                    <div class="info-row"><span class="label">Relationship:</span><span class="value">${userInfo.spouse.relationship}</span></div>
                `;
            } else {
                // ===========================================
                // DEFAULT ADDITIONAL DETAILS DISPLAY
                // ===========================================
                // User has no spouse information - show generic additional details
                
                // Keep default title for users without spouse information
                additionalDetailsTitle.textContent = 'Additional Details';
                
                // Hide spouse image since no spouse information is available
                const additionalDetailsImage = document.getElementById('additionalDetailsImage');
                if (additionalDetailsImage) {
                    additionalDetailsImage.style.display = 'none';
                }
                
                // Remove orange theme styling for users without spouse information
                const additionalDetailsPanel = additionalDetailsTitle.closest('.panel-card');
                if (additionalDetailsPanel) {
                    additionalDetailsPanel.removeAttribute('data-wife-details');
                }
                
                // Display generic message for users without additional details
                additionalDetailsBody.innerHTML = '<div class="empty-message">No additional details available</div>';
            }
            
            // ===========================================
            // UPDATE WELCOME MESSAGE
            // ===========================================
            // Personalize the welcome message with the user's actual name
            // This creates a more engaging and personalized user experience
            
            const welcomeTitle = document.getElementById('welcomeTitle');
            if (welcomeTitle) {
                welcomeTitle.textContent = `Welcome, ${userInfo.name}!`;
            }
        
            // ===========================================
            // UPDATE PROFILE INFORMATION
            // ===========================================
            // Update the profile card with user-specific information
            // This includes the user's name and designation for quick reference
            
            const profileName = document.getElementById('profileName');
            const profileDesignation = document.getElementById('profileDesignation');
            if (profileName) profileName.textContent = userInfo.name;
            if (profileDesignation) profileDesignation.textContent = userInfo.designation || 'User';
        
            // ===========================================
            // UPDATE PROFILE INITIALS (FALLBACK)
            // ===========================================
            // Generate initials from the user's name as a fallback display
            // This is shown when the profile image fails to load
            // Format: First letter of each name part (e.g., "Col Tarunpreet Singh" → "CTS")
            
            const profileInitials = document.getElementById('profileInitials');
            if (profileInitials) {
        const initials = userInfo.name.split(' ').map(n => n[0]).join('').toUpperCase();
                profileInitials.textContent = initials;
            }
            
            // ===========================================
            // UPDATE LEFT PANEL INFORMATION
            // ===========================================
            // Update the left navigation panel with user-specific information
            // This provides consistent user identification throughout the interface
            
            const leftPanelName = document.querySelector('.lp-name');
            const leftPanelRole = document.querySelector('.lp-role');
            if (leftPanelName) leftPanelName.textContent = userInfo.name;
            if (leftPanelRole) leftPanelRole.textContent = userInfo.designation || 'User';
        
        // Set profile image based on user
            let profileImage = 'public/profile.png';
        switch(userInfo.userId) {
            case 'tarunpreet singh':
                profileImage = 'public/Gemini_Generated_Image_4jitd24jitd24jit.png';
                break;
            case 'piyush sharma':
                profileImage = 'public/piyush.jpeg';
                break;
            case 'harish kumar':
                    profileImage = 'public/harish.jpeg';
                break;
            case 'rahul t more':
                profileImage = 'public/Rahul.jpeg';
                break;
            case 'bt01':
                profileImage = 'public/profile.png';
                break;
            default:
                profileImage = 'public/profile.png';
        }
        
        // Update profile images
        const profileImages = document.querySelectorAll('.avatar-box-img, .lp-avatar-img');
        profileImages.forEach(img => {
            img.src = profileImage;
        });
        }

// Logout function
function logout() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('userInfo');
        window.location.href = 'login2.html';
    }
}


// Update Newsletter Analytics function
function updateNewsletterAnalytics() {
    // Get current values
    const totalSubscribersEl = document.getElementById('totalSubscribers');
    const lastSentEl = document.getElementById('lastSent');
    
    if (totalSubscribersEl) {
        const currentSubscribers = parseInt(totalSubscribersEl.textContent.replace(',', ''));
        const newSubscribers = currentSubscribers + Math.floor(Math.random() * 5) + 1; // Add 1-5 new subscribers
        totalSubscribersEl.textContent = newSubscribers.toLocaleString();
    }
    
    if (lastSentEl) {
        const currentSent = parseInt(lastSentEl.textContent);
        lastSentEl.textContent = currentSent + 1;
    }
    
    // Add some animation to the updated values
    if (totalSubscribersEl) {
        totalSubscribersEl.style.transform = 'scale(1.1)';
        setTimeout(() => {
            totalSubscribersEl.style.transform = 'scale(1)';
        }, 300);
    }
    
    if (lastSentEl) {
        lastSentEl.style.transform = 'scale(1.1)';
        setTimeout(() => {
            lastSentEl.style.transform = 'scale(1)';
        }, 300);
    }
}

// Initialize Newsletter Charts
function initNewsletterCharts() {
    console.log('Initializing newsletter charts...');
    // Chart 1: Newsletter Opens Over Time (September 2025)
    const opensCtx = document.getElementById('newsletterOpensChart');
    if (opensCtx) {
        new Chart(opensCtx, {
            type: 'line',
            data: {
                labels: ['Sep 1', 'Sep 5', 'Sep 10', 'Sep 15', 'Sep 20', 'Sep 25', 'Sep 30'],
                datasets: [{
                    label: 'Newsletter Opens',
                    data: [45, 52, 48, 61, 55, 67, 72],
                    borderColor: '#ff8c00',
                    backgroundColor: 'rgba(255, 140, 0, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Newsletter Opens Over Time',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Opens (%)' } }
                }
            }
        });
    }

    // Chart 2: Click Rate by Newsletter Type
    const clickRateCtx = document.getElementById('newsletterClickRateChart');
    if (clickRateCtx) {
        new Chart(clickRateCtx, {
            type: 'doughnut',
            data: {
                labels: ['Monthly Update', 'Event Announcement', 'Workshop Info', 'Community News'],
                datasets: [{
                    data: [32.5, 28.7, 24.3, 18.9],
                    backgroundColor: ['#ff8c00', '#ff9500', '#ffa500', '#ffb347'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Click Rate by Newsletter Type',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { position: 'bottom' }
                }
            }
        });
    }

    // Chart 3: Subscriber Growth
    const growthCtx = document.getElementById('subscriberGrowthChart');
    if (growthCtx) {
        new Chart(growthCtx, {
            type: 'bar',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [{
                    label: 'New Subscribers',
                    data: [18, 22, 15, 25],
                    backgroundColor: '#ff8c00',
                    borderColor: '#ff7f00',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Weekly Subscriber Growth',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'New Subscribers' } }
                }
            }
        });
    }

    // Chart 4: Engagement by Day of Week
    const dayCtx = document.getElementById('engagementByDayChart');
    if (dayCtx) {
        new Chart(dayCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Open Rate (%)',
                    data: [68, 72, 75, 71, 69, 45, 38],
                    backgroundColor: '#ff8c00',
                    borderColor: '#ff7f00',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Engagement by Day of Week',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Open Rate (%)' } }
                }
            }
        });
    }

    // Chart 5: Newsletter Content Performance
    const contentCtx = document.getElementById('contentPerformanceChart');
    if (contentCtx) {
        new Chart(contentCtx, {
            type: 'radar',
            data: {
                labels: ['Events', 'Workshops', 'Community', 'Updates', 'Stories', 'Volunteer'],
                datasets: [{
                    label: 'Engagement Score',
                    data: [85, 78, 92, 88, 76, 82],
                    borderColor: '#ff8c00',
                    backgroundColor: 'rgba(255, 140, 0, 0.2)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Content Performance',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { display: false }
                },
                scales: {
                    r: { beginAtZero: true, max: 100 }
                }
            }
        });
    }

    // Chart 6: Unsubscribe Rate Trend
    const unsubscribeCtx = document.getElementById('unsubscribeRateChart');
    if (unsubscribeCtx) {
        new Chart(unsubscribeCtx, {
            type: 'line',
            data: {
                labels: ['Sep 1', 'Sep 8', 'Sep 15', 'Sep 22', 'Sep 29'],
                datasets: [{
                    label: 'Unsubscribe Rate (%)',
                    data: [2.1, 1.8, 1.5, 1.2, 0.9],
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Unsubscribe Rate Trend',
                        font: { size: 14, weight: 'bold' }
                    },
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Rate (%)' } }
                }
            }
        });
    }
    
    console.log('Newsletter charts initialized successfully!');
}

        // Load user info when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            
            // Initialize newsletter charts
            initNewsletterCharts();
            
            // Initialize navigation state on page load
            const lpNav = document.getElementById('lpNav');
            const navToggle = document.getElementById('navToggle');
            const leftPanel = document.querySelector('.left-panel');
            
            if (window.innerWidth <= 768) {
                // Mobile view - start with collapsed navigation
                lpNav.classList.add('collapsed');
                navToggle.style.display = 'block';
            } else {
                // Desktop view - always show navigation
                lpNav.classList.remove('collapsed', 'expanded');
                navToggle.style.display = 'none';
            }
            
            // Handle window resize for responsive behavior
            window.addEventListener('resize', function() {
                if (window.innerWidth <= 768) {
                    // Mobile view
                    navToggle.style.display = 'block';
                } else {
                    // Desktop view
                    navToggle.style.display = 'none';
                    lpNav.classList.remove('collapsed', 'expanded');
                    // Close mobile menu if open
                    closeMobileMenu();
                }
            });
            
            // Add keyboard support for mobile menu
            document.addEventListener('keydown', function(e) {
                const mobileNavPopup = document.getElementById('mobileNavPopup');
                if (e.key === 'Escape' && !mobileNavPopup.classList.contains('hidden')) {
                    closeMobileMenu();
                }
            });
            
            // Prevent body scroll when mobile menu is open
            const mobileNavPopup = document.getElementById('mobileNavPopup');
            mobileNavPopup.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, { passive: false });
        });

        // Mobile Menu Toggle Functionality
        function toggleMobileMenu() {
            const mobileNavPopup = document.getElementById('mobileNavPopup');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const icon = mobileMenuToggle.querySelector('i');
            
            if (mobileNavPopup.classList.contains('hidden')) {
                // Open mobile menu
                mobileNavPopup.classList.remove('hidden');
                icon.className = 'fas fa-times';
                document.body.style.overflow = 'hidden'; // Prevent scrolling
                console.log('Mobile menu opened');
            } else {
                // Close mobile menu
                mobileNavPopup.classList.add('hidden');
                icon.className = 'fas fa-bars';
                document.body.style.overflow = ''; // Restore scrolling
                console.log('Mobile menu closed');
            }
        }
        
        // Close Mobile Menu
        function closeMobileMenu() {
            const mobileNavPopup = document.getElementById('mobileNavPopup');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const icon = mobileMenuToggle.querySelector('i');
            
            mobileNavPopup.classList.add('hidden');
            icon.className = 'fas fa-bars';
            document.body.style.overflow = ''; // Restore scrolling
            console.log('Mobile menu closed');
        }
        
        // Navigate to Section (Mobile)
        function navigateToSection(sectionId) {
            // Close mobile menu first
            closeMobileMenu();
            
            // Update active states
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-target') === sectionId) {
                    item.classList.add('active');
                }
            });
            
            // Update desktop navigation active states
            const desktopNavItems = document.querySelectorAll('.lp-nav li');
            desktopNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-target') === sectionId) {
                    item.classList.add('active');
                }
            });
            
            // Show the target section
            const sections = document.querySelectorAll('.app-section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            console.log('Navigated to:', sectionId);
        }
        
        // Sidebar Toggle Functionality
        function toggleSidebar() {
            const leftPanel = document.querySelector('.left-panel');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const icon = sidebarToggleBtn.querySelector('i');
            
            if (leftPanel.classList.contains('collapsed')) {
                // Expand sidebar
                leftPanel.classList.remove('collapsed');
                icon.className = 'fas fa-arrow-right';
                console.log('Sidebar expanded');
            } else {
                // Collapse sidebar
                leftPanel.classList.add('collapsed');
                icon.className = 'fas fa-arrow-left';
                console.log('Sidebar collapsed');
            }
        }

        // Navigation toggle functionality - TO BE FIXED BY JYOTI
        // Current implementation has issues with button visibility and functionality
        function toggleNavigation() {
            console.log('Toggle navigation clicked');
            const navToggle = document.getElementById('navToggle');
            const lpNav = document.getElementById('lpNav');
            const icon = navToggle.querySelector('i');
            const text = navToggle.querySelector('span');
            
            console.log('Current nav state:', lpNav.classList.contains('expanded') ? 'expanded' : 'collapsed');
            
            if (lpNav.classList.contains('expanded')) {
                // Collapse navigation
                lpNav.classList.remove('expanded');
                lpNav.classList.add('collapsed');
                icon.className = 'fas fa-chevron-down';
                text.textContent = 'Menu';
                navToggle.classList.remove('active');
                console.log('Navigation collapsed');
            } else {
                // Expand navigation
                lpNav.classList.remove('collapsed');
                lpNav.classList.add('expanded');
                icon.className = 'fas fa-chevron-up';
                text.textContent = 'Close';
                navToggle.classList.add('active');
                console.log('Navigation expanded');
            }
        }

        // Auto-collapse navigation on mobile when clicking outside
        document.addEventListener('click', function(event) {
            const navToggle = document.getElementById('navToggle');
            const lpNav = document.getElementById('lpNav');
            const leftPanel = document.querySelector('.left-panel');
            
            // Check if we're on mobile (screen width <= 768px)
            if (window.innerWidth <= 768) {
                // If click is outside the left panel and navigation is expanded
                if (!leftPanel.contains(event.target) && lpNav.classList.contains('expanded')) {
                    lpNav.classList.remove('expanded');
                    lpNav.classList.add('collapsed');
                    const icon = navToggle.querySelector('i');
                    const text = navToggle.querySelector('span');
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    text.textContent = 'Menu';
                    navToggle.classList.remove('active');
                }
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const lpNav = document.getElementById('lpNav');
            const navToggle = document.getElementById('navToggle');
            
            if (window.innerWidth > 768) {
                // Desktop view - always show navigation
                lpNav.classList.remove('collapsed', 'expanded');
                navToggle.style.display = 'none';
            } else {
                // Mobile view - show toggle button
                navToggle.style.display = 'block';
                if (!lpNav.classList.contains('expanded')) {
                    lpNav.classList.add('collapsed');
                }
            }
        });

        // ===========================================
        // ABOUT DEEP POPUP FUNCTIONS
        // ===========================================
        // Functions to handle the About Deep popup display and interaction.

        function openAboutDeepPopup() {
            const popup = document.getElementById("aboutDeepPopup");
            if (!popup) {
                console.error("About Deep popup element not found!");
                return;
            }

            popup.classList.remove("hidden");
            setTimeout(() => {
                popup.classList.add("open");
            }, 10);

            // Prevent body scroll when popup is open
            document.body.style.overflow = "hidden";
        }

        function closeAboutDeepPopup() {
            const popup = document.getElementById("aboutDeepPopup");
            if (!popup) return;

            popup.classList.remove("open");
            setTimeout(() => {
                popup.classList.add("hidden");
            }, 300);

            // Restore body scroll
            document.body.style.overflow = "auto";
        }
</script>

    <!-- About Deep Popup -->
    <div id="aboutDeepPopup" class="about-deep-popup hidden">
      <div class="about-deep-overlay" onclick="closeAboutDeepPopup()"></div>
      <div class="about-deep-content">
        <div class="about-deep-header">
          <h2>About "Project Deep"</h2>
          <button class="about-deep-close" onclick="closeAboutDeepPopup()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="about-deep-images">
          <img src="public/1.png" alt="Deep Image 1" class="about-deep-image" />
          <img src="public/2.png" alt="Deep Image 2" class="about-deep-image" />
        </div>
      </div>
    </div>

</body>
</html>

